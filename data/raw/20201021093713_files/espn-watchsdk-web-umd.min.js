var _____WB$wombat$assign$function_____ = function(name) {return (self._wb_wombat && self._wb_wombat.local_init && self._wb_wombat.local_init(name)) || self[name]; };
if (!self.__WB_pmw) { self.__WB_pmw = function(obj) { this.__WB_source = obj; return this; } }
{
  let window = _____WB$wombat$assign$function_____("window");
  let self = _____WB$wombat$assign$function_____("self");
  let document = _____WB$wombat$assign$function_____("document");
  let location = _____WB$wombat$assign$function_____("location");
  let top = _____WB$wombat$assign$function_____("top");
  let parent = _____WB$wombat$assign$function_____("parent");
  let frames = _____WB$wombat$assign$function_____("frames");
  let opener = _____WB$wombat$assign$function_____("opener");

!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).WatchSDK={})}(this,(function(t){"use strict";
/** @preserve ESPN WatchSDK 2.4.7 */function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function i(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}function r(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function a(){return(a=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t}).apply(this,arguments)}function o(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function s(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?o(n,!0).forEach((function(e){r(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):o(n).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function u(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&l(t,e)}function c(t){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function l(t,e){return(l=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function h(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function d(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?h(t):e}function f(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=c(t)););return t}function p(t,e,n){return(p="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=f(t,e);if(i){var r=Object.getOwnPropertyDescriptor(i,e);return r.get?r.get.call(n):r.value}})(t,e,n||t)}function v(t,e,n,i){return(v="undefined"!=typeof Reflect&&Reflect.set?Reflect.set:function(t,e,n,i){var a,o=f(t,e);if(o){if((a=Object.getOwnPropertyDescriptor(o,e)).set)return a.set.call(i,n),!0;if(!a.writable)return!1}if(a=Object.getOwnPropertyDescriptor(i,e)){if(!a.writable)return!1;a.value=n,Object.defineProperty(i,e,a)}else r(i,e,n);return!0})(t,e,n,i)}function y(t,e,n,i,r){if(!v(t,e,n,i||t)&&r)throw new Error("failed to set property");return n}function g(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if(!(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)))return;var n=[],i=!0,r=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(i=(o=s.next()).done)&&(n.push(o.value),!e||n.length!==e);i=!0);}catch(t){r=!0,a=t}finally{try{i||null==s.return||s.return()}finally{if(r)throw a}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function m(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var b="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function k(t,e){return t(e={exports:{}},e.exports),e.exports}var A=k((function(t){var e,n;e=b,n=function(){var t=function(){},e="undefined",n=["trace","debug","info","warn","error"];function i(t,e){var n=t[e];if("function"==typeof n.bind)return n.bind(t);try{return Function.prototype.bind.call(n,t)}catch(e){return function(){return Function.prototype.apply.apply(n,[t,arguments])}}}function r(e,i){for(var r=0;r<n.length;r++){var a=n[r];this[a]=r<e?t:this.methodFactory(a,e,i)}this.log=this.debug}function a(t,n,i){return function(){typeof console!==e&&(r.call(this,n,i),this[t].apply(this,arguments))}}function o(n,r,o){return function(n){return"debug"===n&&(n="log"),typeof console!==e&&(void 0!==console[n]?i(console,n):void 0!==console.log?i(console,"log"):t)}(n)||a.apply(this,arguments)}function s(t,i,a){var s,u=this,c="loglevel";function l(){var t;if(typeof window!==e){try{t=window.localStorage[c]}catch(t){}if(typeof t===e)try{var n=window.document.cookie,i=n.indexOf(encodeURIComponent(c)+"=");-1!==i&&(t=/^([^;]+)/.exec(n.slice(i))[1])}catch(t){}return void 0===u.levels[t]&&(t=void 0),t}}t&&(c+=":"+t),u.name=t,u.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},u.methodFactory=a||o,u.getLevel=function(){return s},u.setLevel=function(i,a){if("string"==typeof i&&void 0!==u.levels[i.toUpperCase()]&&(i=u.levels[i.toUpperCase()]),!("number"==typeof i&&i>=0&&i<=u.levels.SILENT))throw"log.setLevel() called with invalid level: "+i;if(s=i,!1!==a&&function(t){var i=(n[t]||"silent").toUpperCase();if(typeof window!==e){try{return void(window.localStorage[c]=i)}catch(t){}try{window.document.cookie=encodeURIComponent(c)+"="+i+";"}catch(t){}}}(i),r.call(u,i,t),typeof console===e&&i<u.levels.SILENT)return"No console available for logging"},u.setDefaultLevel=function(t){l()||u.setLevel(t,!1)},u.enableAll=function(t){u.setLevel(u.levels.TRACE,t)},u.disableAll=function(t){u.setLevel(u.levels.SILENT,t)};var h=l();null==h&&(h=null==i?"WARN":i),u.setLevel(h,!1)}var u=new s,c={};u.getLogger=function(t){if("string"!=typeof t||""===t)throw new TypeError("You must supply a name when creating a logger.");var e=c[t];return e||(e=c[t]=new s(t,u.getLevel(),u.methodFactory)),e};var l=typeof window!==e?window.log:void 0;return u.noConflict=function(){return typeof window!==e&&window.log===u&&(window.log=l),u},u.getLoggers=function(){return c},u},t.exports?t.exports=n():e.log=n()})),I=Object.freeze({__proto__:null,default:A,__moduleExports:A});function P(t){return t?(t^16*Math.random()>>t/4).toString(16):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,P)}var w=k((function(t,e){
/*!
   * @overview es6-promise - a tiny implementation of Promises/A+.
   * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
   * @license   Licensed under MIT license
   *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
   * @version   v4.2.8+1e68dce6
   */
t.exports=function(){function t(t){return"function"==typeof t}var e=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},n=0,i=void 0,r=void 0,a=function(t,e){d[n]=t,d[n+1]=e,2===(n+=2)&&(r?r(f):m())},o="undefined"!=typeof window?window:void 0,s=o||{},u=s.MutationObserver||s.WebKitMutationObserver,c="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"==={}.toString.call(process),l="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function h(){var t=setTimeout;return function(){return t(f,1)}}var d=new Array(1e3);function f(){for(var t=0;t<n;t+=2)(0,d[t])(d[t+1]),d[t]=void 0,d[t+1]=void 0;n=0}var p,v,y,g,m=void 0;function k(t,e){var n=this,i=new this.constructor(P);void 0===i[I]&&R(i);var r=n._state;if(r){var o=arguments[r-1];a((function(){return N(r,i,o,n._result)}))}else D(n,i,t,e);return i}function A(t){if(t&&"object"==typeof t&&t.constructor===this)return t;var e=new this(P);return E(e,t),e}c?m=function(){return process.nextTick(f)}:u?(v=0,y=new u(f),g=document.createTextNode(""),y.observe(g,{characterData:!0}),m=function(){g.data=v=++v%2}):l?((p=new MessageChannel).port1.onmessage=f,m=function(){return p.port2.postMessage(0)}):m=void 0===o?function(){try{var t=Function("return this")().require("vertx");return void 0!==(i=t.runOnLoop||t.runOnContext)?function(){i(f)}:h()}catch(t){return h()}}():h();var I=Math.random().toString(36).substring(2);function P(){}var w=void 0,S=1,_=2;function T(e,n,i){n.constructor===e.constructor&&i===k&&n.constructor.resolve===A?function(t,e){e._state===S?M(t,e._result):e._state===_?O(t,e._result):D(e,void 0,(function(e){return E(t,e)}),(function(e){return O(t,e)}))}(e,n):void 0===i?M(e,n):t(i)?function(t,e,n){a((function(t){var i=!1,r=function(t,e,n,i){try{t.call(e,n,i)}catch(t){return t}}(n,e,(function(n){i||(i=!0,e!==n?E(t,n):M(t,n))}),(function(e){i||(i=!0,O(t,e))}),t._label);!i&&r&&(i=!0,O(t,r))}),t)}(e,n,i):M(e,n)}function E(t,e){if(t===e)O(t,new TypeError("You cannot resolve a promise with itself"));else if(r=typeof(i=e),null===i||"object"!==r&&"function"!==r)M(t,e);else{var n=void 0;try{n=e.then}catch(e){return void O(t,e)}T(t,e,n)}var i,r}function C(t){t._onerror&&t._onerror(t._result),U(t)}function M(t,e){t._state===w&&(t._result=e,t._state=S,0!==t._subscribers.length&&a(U,t))}function O(t,e){t._state===w&&(t._state=_,t._result=e,a(C,t))}function D(t,e,n,i){var r=t._subscribers,o=r.length;t._onerror=null,r[o]=e,r[o+S]=n,r[o+_]=i,0===o&&t._state&&a(U,t)}function U(t){var e=t._subscribers,n=t._state;if(0!==e.length){for(var i=void 0,r=void 0,a=t._result,o=0;o<e.length;o+=3)i=e[o],r=e[o+n],i?N(n,i,r,a):r(a);t._subscribers.length=0}}function N(e,n,i,r){var a=t(i),o=void 0,s=void 0,u=!0;if(a){try{o=i(r)}catch(t){u=!1,s=t}if(n===o)return void O(n,new TypeError("A promises callback cannot return that same promise."))}else o=r;n._state!==w||(a&&u?E(n,o):!1===u?O(n,s):e===S?M(n,o):e===_&&O(n,o))}var L=0;function R(t){t[I]=L++,t._state=void 0,t._result=void 0,t._subscribers=[]}var j=function(){function t(t,n){this._instanceConstructor=t,this.promise=new t(P),this.promise[I]||R(this.promise),e(n)?(this.length=n.length,this._remaining=n.length,this._result=new Array(this.length),0===this.length?M(this.promise,this._result):(this.length=this.length||0,this._enumerate(n),0===this._remaining&&M(this.promise,this._result))):O(this.promise,new Error("Array Methods must be provided an Array"))}return t.prototype._enumerate=function(t){for(var e=0;this._state===w&&e<t.length;e++)this._eachEntry(t[e],e)},t.prototype._eachEntry=function(t,e){var n=this._instanceConstructor,i=n.resolve;if(i===A){var r=void 0,a=void 0,o=!1;try{r=t.then}catch(t){o=!0,a=t}if(r===k&&t._state!==w)this._settledAt(t._state,e,t._result);else if("function"!=typeof r)this._remaining--,this._result[e]=t;else if(n===H){var s=new n(P);o?O(s,a):T(s,t,r),this._willSettleAt(s,e)}else this._willSettleAt(new n((function(e){return e(t)})),e)}else this._willSettleAt(i(t),e)},t.prototype._settledAt=function(t,e,n){var i=this.promise;i._state===w&&(this._remaining--,t===_?O(i,n):this._result[e]=n),0===this._remaining&&M(i,this._result)},t.prototype._willSettleAt=function(t,e){var n=this;D(t,void 0,(function(t){return n._settledAt(S,e,t)}),(function(t){return n._settledAt(_,e,t)}))},t}(),H=function(){function e(t){this[I]=L++,this._result=this._state=void 0,this._subscribers=[],P!==t&&("function"!=typeof t&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof e?function(t,e){try{e((function(e){E(t,e)}),(function(e){O(t,e)}))}catch(e){O(t,e)}}(this,t):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return e.prototype.catch=function(t){return this.then(null,t)},e.prototype.finally=function(e){var n=this.constructor;return t(e)?this.then((function(t){return n.resolve(e()).then((function(){return t}))}),(function(t){return n.resolve(e()).then((function(){throw t}))})):this.then(e,e)},e}();return H.prototype.then=k,H.all=function(t){return new j(this,t).promise},H.race=function(t){var n=this;return e(t)?new n((function(e,i){for(var r=t.length,a=0;a<r;a++)n.resolve(t[a]).then(e,i)})):new n((function(t,e){return e(new TypeError("You must pass an array to race."))}))},H.resolve=A,H.reject=function(t){var e=new this(P);return O(e,t),e},H._setScheduler=function(t){r=t},H._setAsap=function(t){a=t},H._asap=a,H.polyfill=function(){var t=void 0;if(void 0!==b)t=b;else if("undefined"!=typeof self)t=self;else try{t=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var e=t.Promise;if(e){var n=null;try{n=Object.prototype.toString.call(e.resolve())}catch(t){}if("[object Promise]"===n&&!e.cast)return}t.Promise=H},H.Promise=H,H}()})),S=function(t){return 200===t.status||201===t.status||202===t.status||204===t.status||0===t.status&&t.responseText&&""!==t.responseText};function _(t,e){return e=e||{},new w((function(n,i){var r=new XMLHttpRequest;for(var a in r.open(e.method||"get",t,!0),e.headers)r.setRequestHeader(a,e.headers[a]);function o(){var t,e=[],n=[],i={};return r.getAllResponseHeaders().replace(/^(.*?):\s*?([\s\S]*?)$/gm,(function(r,a,o){e.push(a=a.toLowerCase()),n.push([a,o]),t=i[a],i[a]=t?"".concat(t,",").concat(o):o})),{ok:2==(r.status/100|0),status:r.status,statusText:r.statusText,url:r.responseURL,clone:o,text:function(){return w.resolve(r.responseText)},json:function(){return w.resolve(r.responseText).then((function(t){try{return JSON.parse(t)}catch(t){return{}}}))},blob:function(){return w.resolve(new Blob([r.response]))},headers:{keys:function(){return e},entries:function(){return n},get:function(t){return i[t.toLowerCase()]},has:function(t){return t.toLowerCase()in i}}}}r.withCredentials="include"===e.credentials,r.onload=function(){n(o())},r.onreadystatechange=function(){try{4===r.readyState&&(S(r)?n(o()):i(o()))}catch(t){r.abort()}},r.onerror=i,r.send(e.body)}))}var T=k((function(t,e){var n;t.exports=(n=n||function(t,e){var n=Object.create||function(){function t(){}return function(e){var n;return t.prototype=e,n=new t,t.prototype=null,n}}(),i={},r=i.lib={},a=r.Base={extend:function(t){var e=n(this);return t&&e.mixIn(t),e.hasOwnProperty("init")&&this.init!==e.init||(e.init=function(){e.$super.init.apply(this,arguments)}),e.init.prototype=e,e.$super=this,e},create:function(){var t=this.extend();return t.init.apply(t,arguments),t},init:function(){},mixIn:function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function(){return this.init.prototype.extend(this)}},o=r.WordArray=a.extend({init:function(t,e){t=this.words=t||[],this.sigBytes=null!=e?e:4*t.length},toString:function(t){return(t||u).stringify(this)},concat:function(t){var e=this.words,n=t.words,i=this.sigBytes,r=t.sigBytes;if(this.clamp(),i%4)for(var a=0;a<r;a++){var o=n[a>>>2]>>>24-a%4*8&255;e[i+a>>>2]|=o<<24-(i+a)%4*8}else for(a=0;a<r;a+=4)e[i+a>>>2]=n[a>>>2];return this.sigBytes+=r,this},clamp:function(){var e=this.words,n=this.sigBytes;e[n>>>2]&=4294967295<<32-n%4*8,e.length=t.ceil(n/4)},clone:function(){var t=a.clone.call(this);return t.words=this.words.slice(0),t},random:function(e){for(var n,i=[],r=function(e){e=e;var n=987654321,i=4294967295;return function(){var r=((n=36969*(65535&n)+(n>>16)&i)<<16)+(e=18e3*(65535&e)+(e>>16)&i)&i;return r/=4294967296,(r+=.5)*(t.random()>.5?1:-1)}},a=0;a<e;a+=4){var s=r(4294967296*(n||t.random()));n=987654071*s(),i.push(4294967296*s()|0)}return new o.init(i,e)}}),s=i.enc={},u=s.Hex={stringify:function(t){for(var e=t.words,n=t.sigBytes,i=[],r=0;r<n;r++){var a=e[r>>>2]>>>24-r%4*8&255;i.push((a>>>4).toString(16)),i.push((15&a).toString(16))}return i.join("")},parse:function(t){for(var e=t.length,n=[],i=0;i<e;i+=2)n[i>>>3]|=parseInt(t.substr(i,2),16)<<24-i%8*4;return new o.init(n,e/2)}},c=s.Latin1={stringify:function(t){for(var e=t.words,n=t.sigBytes,i=[],r=0;r<n;r++){var a=e[r>>>2]>>>24-r%4*8&255;i.push(String.fromCharCode(a))}return i.join("")},parse:function(t){for(var e=t.length,n=[],i=0;i<e;i++)n[i>>>2]|=(255&t.charCodeAt(i))<<24-i%4*8;return new o.init(n,e)}},l=s.Utf8={stringify:function(t){try{return decodeURIComponent(escape(c.stringify(t)))}catch(t){throw new Error("Malformed UTF-8 data")}},parse:function(t){return c.parse(unescape(encodeURIComponent(t)))}},h=r.BufferedBlockAlgorithm=a.extend({reset:function(){this._data=new o.init,this._nDataBytes=0},_append:function(t){"string"==typeof t&&(t=l.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function(e){var n=this._data,i=n.words,r=n.sigBytes,a=this.blockSize,s=r/(4*a),u=(s=e?t.ceil(s):t.max((0|s)-this._minBufferSize,0))*a,c=t.min(4*u,r);if(u){for(var l=0;l<u;l+=a)this._doProcessBlock(i,l);var h=i.splice(0,u);n.sigBytes-=c}return new o.init(h,c)},clone:function(){var t=a.clone.call(this);return t._data=this._data.clone(),t},_minBufferSize:0}),d=(r.Hasher=h.extend({cfg:a.extend(),init:function(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function(){h.reset.call(this),this._doReset()},update:function(t){return this._append(t),this._process(),this},finalize:function(t){return t&&this._append(t),this._doFinalize()},blockSize:16,_createHelper:function(t){return function(e,n){return new t.init(n).finalize(e)}},_createHmacHelper:function(t){return function(e,n){return new d.HMAC.init(t,n).finalize(e)}}}),i.algo={});return i}(Math),n)})),E=k((function(t,e){t.exports=T.enc.Utf8})),C=k((function(t,e){var n,i,r;t.exports=(i=(n=r=T).lib.WordArray,n.enc.Base64={stringify:function(t){var e=t.words,n=t.sigBytes,i=this._map;t.clamp();for(var r=[],a=0;a<n;a+=3)for(var o=(e[a>>>2]>>>24-a%4*8&255)<<16|(e[a+1>>>2]>>>24-(a+1)%4*8&255)<<8|e[a+2>>>2]>>>24-(a+2)%4*8&255,s=0;s<4&&a+.75*s<n;s++)r.push(i.charAt(o>>>6*(3-s)&63));var u=i.charAt(64);if(u)for(;r.length%4;)r.push(u);return r.join("")},parse:function(t){var e=t.length,n=this._map,r=this._reverseMap;if(!r){r=this._reverseMap=[];for(var a=0;a<n.length;a++)r[n.charCodeAt(a)]=a}var o=n.charAt(64);if(o){var s=t.indexOf(o);-1!==s&&(e=s)}return function(t,e,n){for(var r=[],a=0,o=0;o<e;o++)if(o%4){var s=n[t.charCodeAt(o-1)]<<o%4*2,u=n[t.charCodeAt(o)]>>>6-o%4*2;r[a>>>2]|=(s|u)<<24-a%4*8,a++}return i.create(r,a)}(t,e,r)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},r.enc.Base64)})),M=function(){function t(){e(this,t)}return i(t,[{key:"getConfiguration",value:function(t,e){return{}}}]),t}(),O="BootstrapManager.bootstrap",D=!1;try{D="caches"in self}catch(t){}var U=function(t){function n(){var t;if(e(this,n),(t=d(this,c(n).call(this)))._bootstrap=null,t._cache=null,D)caches.open("watchsdk-cache").then((function(e){t._cache=e,e&&e.match("bootstrap").then((function(t){return t&&t.json()})).then((function(e){e&&(t._bootstrap=e)}))}));else{var i=localStorage.getItem(O);try{var r=JSON.parse(E.stringify(C.parse(i)));t._bootstrap=r}catch(e){try{var a=JSON.parse(i);t._bootstrap=a}catch(t){}}}return t}return u(n,t),i(n,[{key:"update",value:function(t){var e=this;return _(t).then((function(t){return t.json()})).then((function(t){if(A.debug("BootstrapManager.update() ".concat(JSON.stringify(t,null,2))),e._bootstrap=t,e._cache&&e._cache.put("bootstrap",new Response(JSON.stringify(t),{headers:{"Content-Type":"application/json"}})),!D){var n=C.stringify(E.parse(JSON.stringify(t)));localStorage.setItem(O,n)}}))}},{key:"getConfiguration",value:function(t,e){var n=this.bootstrap,i=n&&n[t]||{};if(e){var a=Object.keys(i).filter((function(t){return-1!==Object.keys(e).indexOf(t)})).reduce((function(t,e){return s({},t,r({},e,i[e]))}),{});i=s({},e,{},a)}return i}},{key:"bootstrap",get:function(){return this._bootstrap}}]),n}(M);U.shared=new U;var N="https://web.archive.org/web/20201021044330/https://streams.adobeprimetime.com/v2",L="live",R="vod",j="accountId",H="applicationId",z="applicationPlatform",x="channel",B="contentType",F="contractType",J="deviceModel",K="hba",V="mobileDevice",G="programmerName",q=function(t){var e="".concat(t,":");return{Authorization:"Basic ".concat(C.stringify(E.parse(e))),Accept:"application/json"}},W=function(){function t(n,i,r,a,o){e(this,t),i&&r&&a&&(this.programmer=n,this.applicationId=i,this.identityProvider=r,this.subject=a,this.metadata=o||{},this.serviceUrl=N,this.requestHeaders=q(i),this.heartbeatIntervalId=null,this.messages={})}return i(t,[{key:"start",value:function(){var t=this;return this.createSession().then((function(e){if(e)return t.scheduleHeartbeat(),e}))}},{key:"startWithSession",value:function(t){this.sessionId=t,this.scheduleHeartbeat()}},{key:"stop",value:function(){this.heartbeatIntervalId&&(clearInterval(this.heartbeatIntervalId),this.heartbeatIntervalId=null),this.terminateSession()}},{key:"createSession",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];A.debug("AdobeConcurrencyMonitorV2.createSession");var n="".concat(this.serviceUrl,"/sessions/").concat(this.identityProvider,"/").concat(this.subject),i=s({"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},this.requestHeaders);e.length>0&&(i["X-Terminate"]=e.join(","));var r=this.getMetadata(),a=Object.keys(r).map((function(t){return"".concat(t,"=").concat(encodeURIComponent(r[t]))})).join("&"),o={method:"POST",headers:i,body:a};return _(n,o).then((function(e){var n=e.status;if(!(n>=200&&n<300))throw e;var i=e.headers.get("location").trim();return t.sessionId=i,A.debug("AdobeConcurrencyMonitorV2.createSession sessionId:",i),i})).catch((function(e){return t.handleError(e)}))}},{key:"scheduleHeartbeat",value:function(){var t=this;A.debug("AdobeConcurrencyMonitorV2.scheduleHeartbeat"),this.heartbeatIntervalId=setTimeout((function(){t.heartbeat()}),45e3)}},{key:"heartbeat",value:function(){var t=this,e=this.sessionId;e&&(A.debug("AdobeConcurrencyMonitorV2.heartbeat",e),_("".concat(this.serviceUrl,"/sessions/").concat(this.identityProvider,"/").concat(this.subject,"/").concat(e),{method:"POST",headers:this.requestHeaders}).then((function(e){var n=e.status;if(!(n>=200&&n<300))throw e;t.scheduleHeartbeat()})).catch((function(e){return t.handleError(e,t.onError)})))}},{key:"terminateSession",value:function(){var t=this.sessionId;t&&_("".concat(this.serviceUrl,"/sessions/").concat(this.identityProvider,"/").concat(this.subject,"/").concat(t),{method:"DELETE",headers:this.requestHeaders}).then((function(t){var e=t.status;if(!(e>=200&&e<300))throw t}))}},{key:"handleError",value:function(e,n){var i=this;switch(A.debug("AdobeConcurrencyMonitorV2.handleError",e),e.status){case 400:return e.json().then((function(e){if(!!(e.obligations||[]).find((function(t){return"logout"===t.action})))return t.fetchMetadataKeys(i.applicationId,i.serviceUrl).then((function(){var t=i.metadata;if(Object.keys(t).length>=i.metadataKeys.length)return i.start()}))}));case 409:return e.json().then((function(t){var r=(t.associatedAdvice||[]).find((function(t){return"rule-violation"===t.type}));if(r){var a=r.message,o=i.messages[a]||a,s=new Error(o),u=!!(t.obligations||[]).find((function(t){return"logout"===t.action}));if(A.debug("AdobeConcurrencyMonitorV2.handleError",e.status,s,u),!n)throw s;n(s,u)}}));case 410:return e.json().then((function(t){if(!t)return i.start();var r=(t.associatedAdvice||[]).find((function(t){return"remote-termination"===t.type}));if(r){var a=r.message,o=i.messages[a]||a,s=new Error(o),u=!!t.obligations.find((function(t){return"logout"===t.action}));if(A.debug("AdobeConcurrencyMonitorV2.handleError",e.status,s,u),!n)throw s;n(s,u)}}))}}},{key:"getMetadata",value:function(){var t=this;return this.metadataKeys.reduce((function(e,n){return e[n]=t.metadata[n],e}),{})}},{key:"onError",value:function(t,e){A.debug("AdobeConcurrencyMonitor.onError"),A.debug("error: ".concat(t)),A.debug("shouldLogout: ".concat(e))}},{key:"metadataKeys",get:function(){return function(t){var e="".concat("AdobeCM.metadata",".").concat(t),n=[];try{n=JSON.parse(localStorage.getItem(e))||[]}catch(t){}return n}(this.applicationId)}}],[{key:"fetchMetadataKeys",value:function(t,e){return _("".concat(e,"/metadata"),{method:"GET",headers:q(t)}).then((function(t){return t.json()})).then((function(e){!function(t,e){var n="".concat("AdobeCM.metadata",".").concat(e);localStorage.setItem(n,JSON.stringify(t))}(e,t)})).catch((function(){}))}}]),t}(),Y=new function t(n,i,r,a){e(this,t),this.enabled=n,this.serviceUrl=i,this.applicationId=null,this.applications=r,this.messages=a}(!0,"https://web.archive.org/web/20201021044330/https://streams.adobeprimetime.com/v2",{chromecast:{applicationId:"4c6fd925-7d06-4dbd-9edb-720962619882"},appletv:{applicationId:"eebe77ee-3064-4b4a-b89b-fef248a474be"},samsungtv:{applicationId:"0e3d9128-cdf7-4464-9952-55434ead1e8e"},web:{applicationId:"3bfbbbdf-be8e-40be-9540-97a73469ada2"},ps4:{applicationId:"41e7539c-d38f-4c20-856a-8db2de060287"}},{}),X="https://web.archive.org/web/20201021044330/https://a.espncdn.com/connected-devices/app-configurations/espn-js-sdk-2.0.config.json",Q={appletv:"dniqxcl2cnjuzgl04vuek1mm",chromecast:"1q86jvqka85r41w7daunp5ipgb",ps4:"kbjoe0y9awb41guc2nzey04ji",samsungtv:"csrf56z30hke1aozrm00ad50g",web:"uiqlbgzdwuru14v627vdusswb"},Z=function(t){var e=U.shared.getConfiguration("adobeCM",Y);if(!1!==e.enabled){var n=e.applications&&e.applications[t],i=e.applicationId||n&&n.applicationId,r=e.serviceUrl;W.fetchMetadataKeys(i,r)}},$=function(){function t(){e(this,t)}return i(t,null,[{key:"init",value:function(e,n,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};t.partner=e,t.platform=n,t.version=i,t.deviceId=t.deviceId||P(),A.debug(this.toString());var a=r&&r.bootstrapUrl||X;U.shared.update(a).finally((function(){Z(t.platform)}))}},{key:"toString",value:function(){return"<WatchSDK.Client partner:".concat(t.partner,", platform:").concat(t.platform,", deviceId:").concat(t.deviceId,">")}},{key:"partner",get:function(){return localStorage.getItem("ESPNWatchSDK.Client.partner")},set:function(t){localStorage.setItem("ESPNWatchSDK.Client.partner",t)}},{key:"platform",get:function(){return localStorage.getItem("ESPNWatchSDK.Client.platform")},set:function(t){localStorage.setItem("ESPNWatchSDK.Client.platform",t)}},{key:"version",get:function(){return localStorage.getItem("ESPNWatchSDK.Client.version")},set:function(t){localStorage.setItem("ESPNWatchSDK.Client.version",t)}},{key:"deviceId",get:function(){return localStorage.getItem("ESPNWatchSDK.Client.deviceId")},set:function(t){localStorage.setItem("ESPNWatchSDK.Client.deviceId",t)}},{key:"apiKey",get:function(){return U.shared.getConfiguration("shield",{apiKeys:Q}).apiKeys[t.platform]||"mbmhfdgflphg14wss50rny3ct"}}]),t}(),tt={none:"NONE",startSession:"START_SESSION",bam:"BAM",shield:"SHIELD"},et=function(){function t(n,i,r,a,o,s,u){e(this,t),this.url=n,this.authorizationType=i,this.hasEspnId3Heartbeats=r,this.hasNielsenWatermarks=a,this.hasPassThroughAds=o,this.commercialReplacement=s,this.startSessionUrl=u,this.type=null}return i(t,null,[{key:"fromObject",value:function(e){return e?new t(e.url,e.authorizationType,e.hasEspnId3Heartbeats,e.hasNielsenWatermarks,e.hasPassThroughAds,e.commercialReplacement,e.startSessionUrl):null}}]),t}(),nt="stitchedPreroll",it=function(){function t(n){e(this,t),this.name=n}return i(t,[{key:"logoUrl",get:function(){return"https://secure.espncdn.com/watchespn/images/espnplus/packages/".concat(this.name,".png")}}],[{key:"fromJson",value:function(e){return new t(e.name)}}]),t}(),rt=function(){function t(n,i,r,a){e(this,t),this.id=n,this.type=i,this.name=r,this.adobeResource=a}return i(t,null,[{key:"fromJson",value:function(e){return e?new t(e.id,e.type,e.name,e.adobeResource):null}}]),t}(),at={online:"online",linear:"linear"},ot={airing:"airing",vod:"vod"},st="linear",ut="event",ct="vod",lt={nielsen:"nielsen",comscore:"comscore",conviva:"conviva",heartbeats:"heartbeats"};function ht(t,e){var n=function(t,e){var n=t.duration,i=t.id,r=t.league,a=t.name,o=t.network,s=t.program,u=t.source,c=t.sport,l=t.startDateTime,h=t.tracking,d="1";u&&!0===u.hasEspnId3Heartbeats&&!1===u.hasPassThroughAds&&"SHARED INV"!==u.commercialReplacement&&(d="2");var f=new Date(l),p={type:"content"};return p.assetid=h&&h.trackingId||i,p.program=a,p.title=a,p.clientid="us-600140",e===ot.airing&&(p.length="".concat(n),p.segB=r&&r.name||"No League",p.segC="".concat(s&&s.code||"").concat(c&&c.code||""),p.airdate="".concat(f.getUTCFullYear().toString()+"0".concat(f.getUTCMonth()).slice(-2)+"0".concat(f.getUTCDate()).slice(-2)," ").concat("0".concat(f.getUTCHours()).slice(-2),":").concat("0".concat(f.getUTCMinutes()).slice(-2),":").concat("0".concat(f.getUTCSeconds()).slice(-2)),p.isfullepisode="y",p.crossId1=h&&h.nielsenCrossId1||"",p.crossId2=o&&o.name||"",p.adloadtype=d,p.hasAds="1",p.progen="SE",p.vcid="b01"),e===ot.vod&&(p.accmethod="1",p.length="".concat(n),p.segA=a,p.segB="No League",p.segC="VOD",p.isfullepisode="n",p.crossId1="",p.adloadtype="1",p.vcid="c17",p.adloadtype="2"),p}(t,e),i=function(t,e){var n=t.id,i=t.duration,r=t.name,a=t.league,o=t.startDateTime,s=t.network,u=t.sport,c=t.status,l=t.tracking,h=void 0===l?{}:l,d={};if(e===ot.airing)d.ns_st_cl=0,d.ns_st_ct="vc",!c||"live"!==c.toLowerCase()&&"over"!==c.toLowerCase()?(d.ns_st_cl=i,d.ns_st_ct="vc12",d.ns_st_pr="VOD",d.ns_st_ep=r):(d.ns_st_cl=0,d.ns_st_ct="vc13",d.ns_st_pr=r,d.ns_st_ep="*null"),d.c3="WATCHESPNLIVE",d.c6=a&&a.name?a||"No league":u&&u.code||"No Sport";else{d.ns_st_cl=i,d.ns_st_ct="vc11",d.ns_st_pr="VOD",d.ns_st_ep=r;var f=h.sportName,p=h.leagueName;d.c3="vod",d.c6="".concat(p&&"no league"!==p.toLowerCase()?p:f||"No Sport")}if(d.ns_st_ti="*null",d.ns_st_ia="*null",d.ns_st_ce="*null",d.ns_st_ci=n,o){var v=new Date(o);d.ns_st_ddt=v.toDateString(),d.ns_st_tdt=v.toDateString()}return d.ns_st_st=s?s.id:"*null",d.ns_st_en="*null",d.ns_st_cn="1",d.ns_st_pn="1",d.ns_st_tp="1",d.ns_st_pu="ESPN",d.ns_st_cu="none",d.ns_st_ad="0",d.ns_st_ge="Sports",d}(t,e),r=function(t,e){var n=t.name,i=t.id,r=t.airingId,a=t.eventId,o=t.duration,s=t.source,u=t.network,c=t.status,l="".concat(n," - ").concat(i);u&&u.type===at.linear&&(l=u.id);var h={};return h.contentId=i,r&&(h.airingId=r),a&&(h.eventId="".concat(a)),u&&(h.network=u.id),e===ot.vod?h.assetType="clip":!c||"live"!==c.toLowerCase()&&"over"!==c.toLowerCase()?h.assetType="vod":h.assetType="live",{assetName:l,duration:o,streamUrl:s&&s.url,custom:h}}(t,e),a=function(t,e){var n=t.duration,i=t.airingId,r=t.network,a=t.status,o=t.sport,s=t.league,u=t.program,c=t.startDateTime,l=t.tracking,h=t.originalPublishDate,d=t.expirationDate,f=t.lastModifiedDate,p=t.ad,v=t.coverageType,y={};if(y.ContentDuration=n,e===ot.airing){if(y.isFullEpisode="y",i&&(y.AiringID=i),r&&(y.NetworkName=r.id,y.Channel=r.id),a&&(y.VideoType="REPLAY"===a?"replay":"live"),y.Sport=o&&o.name||"Not Applicable",y.SportCode=o&&o.code||"Not Applicable",y.League=s&&s.name||"Not Applicable",u&&u.code&&u.categoryCode?y.ProgramCode=u.categoryCode+u.code:y.ProgramCode="Not Applicable",y.IsStudio=u&&u.isStudio||"Not Applicable",c){var g=new Date(c);y.AirDate=g.toDateString(),y.AirTime=g.toTimeString()}}else if(e===ot.vod){if(y.isFullEpisode="n",y.VideoType="vod",y.Sport=l&&l.sportName||"Not Applicable",y.League=l&&l.leagueName||"Not Applicable",y.ShowCode=p&&p.bundle||"Not Applicable",l&&l.name&&(y.CMSID=l.name),h){var m=new Date(h);y.PublishDate=m.toISOString().substring(0,10),y.PublishTime=m.toISOString().substring(11)}if(d){var b=new Date(d);y.ExpirationDate=b.toISOString()}if(f){var k=new Date(f);y.DateLastModified=k.toISOString()}v&&(y.VideoTypeDetail=v)}return y}(t,e),o={};return o[lt.nielsen]=n,o[lt.comscore]=i,o[lt.conviva]=r,o[lt.heartbeats]=a,o}var dt={open:"OPEN",direct:"DIRECT",mvpd:"MVPD",isp:"ISP",none:"NONE"},ft=function(){function t(n,i,r,a,o,s,u,c,l,h,d,f,p,v,y,g,m,b,k,A,I,P,w,S,_){e(this,t),this.id=n,this.type=i,this.name=r,this.shortName=a,this.description=o,this.duration=s,this.imageUrl=u,this.eventId=c,this.requiresLinearPlayback=l,this.authTypes=h,this.source=d,this.packages=f,this.language=p||"en",this.mrss=v,this.seekInSeconds=y,this.tracking=m,this.trackingId=g,this.airingId=b,this.simulcastAiringId=k,this.network=A,this.status=I,this.feedName=P,this.tier=w,this.contentSource=S,this.links=_}return i(t,[{key:"toString",value:function(){return"<MediaItem id:".concat(this.id,", name:").concat(this.name,", imageUrl:").concat(this.imageUrl,", status:").concat(this.status,", streamType:").concat(this.streamType,", feedName:").concat(this.feedName,", trackingId:").concat(this.trackingId,">")}},{key:"streamType",get:function(){if(this.type===ot.vod||this.status&&"replay"===this.status.toLowerCase())return ct;if(this.network)switch(this.network.type){case at.linear:return st;case at.online:return ut;default:return null}return null}},{key:"isLive",get:function(){return!!this.status&&("LIVE"===this.status||"OVER"===this.status)}},{key:"isLinear",get:function(){return this.network&&this.network.type===at.linear}},{key:"isOverLinear",get:function(){return"OVER"===this.status&&this.isLinear}},{key:"convivaContentMetadata",get:function(){return this.tracking[lt.conviva]}},{key:"trackingInfo",get:function(){return this.tracking[lt.heartbeats]}},{key:"nielsenMetadata",get:function(){return this.tracking[lt.nielsen]}}],[{key:"fromJson",value:function(e,n,i){var r=e.id,a=e.name,o=e.shortName,s=e.description,u=e.duration,c=e.image.url,l=e.eventId,h=e.requiresLinearPlayback,d=e.authTypes,f=e.source,p=e.prerollSource,v=e.packages,y=e.language,g=e.mrss,m=e.seekInSeconds,b=e.tracking,k=e.airingId,A=e.simulcastAiringId,I=e.network,P=e.status,w=e.feedName,S=e.tier,_=e.contentSource,T=e.links,E=v||[],C=ht(e,n),M=et.fromObject(f);i&&i.sourceType===nt&&p&&((M=et.fromObject(p)).authorizationType=tt.none,M.type=nt);var O=b&&b.trackingId||r;return new t(r,n,a,o,s,u,c,l,h,d,M,E.map((function(t){return it.fromJson(t)})),y,g,m,O,C,k,A,rt.fromJson(I),P,w,S,_,T)}},{key:"fromObject",value:function(e){return new t(e.id,e.type,e.name,e.shortName,e.description,e.duration,e.imageUrl,e.eventId,e.requiresLinearPlayback,e.authTypes,e.source,e.packages,e.language,e.mrss,e.seekInSeconds,e.trackingId,e.tracking,e.airingId,e.simulcastAiringId,e.network,e.status,e.feedName,e.tier,e.contentSource,e.links)}}]),t}(),pt=function(t){return encodeURIComponent(t).replace(/[!'()*]/g,(function(t){return"%"+t.charCodeAt(0).toString(16).toUpperCase()}))},vt=Object.getOwnPropertySymbols,yt=Object.prototype.hasOwnProperty,gt=Object.prototype.propertyIsEnumerable;function mt(t){if(null==t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}var bt=function(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;for(var e={},n=0;n<10;n++)e["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(e).map((function(t){return e[t]})).join(""))return!1;var i={};return"abcdefghijklmnopqrst".split("").forEach((function(t){i[t]=t})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},i)).join("")}catch(t){return!1}}()?Object.assign:function(t,e){for(var n,i,r=mt(t),a=1;a<arguments.length;a++){for(var o in n=Object(arguments[a]))yt.call(n,o)&&(r[o]=n[o]);if(vt){i=vt(n);for(var s=0;s<i.length;s++)gt.call(n,i[s])&&(r[i[s]]=n[i[s]])}}return r},kt=new RegExp("%[a-f0-9]{2}","gi"),At=new RegExp("(%[a-f0-9]{2})+","gi");function It(t,e){try{return decodeURIComponent(t.join(""))}catch(t){}if(1===t.length)return t;e=e||1;var n=t.slice(0,e),i=t.slice(e);return Array.prototype.concat.call([],It(n),It(i))}function Pt(t){try{return decodeURIComponent(t)}catch(i){for(var e=t.match(kt),n=1;n<e.length;n++)e=(t=It(e,n).join("")).match(kt);return t}}var wt=function(t){if("string"!=typeof t)throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof t+"`");try{return t=t.replace(/\+/g," "),decodeURIComponent(t)}catch(e){return function(t){for(var e={"%FE%FF":"��","%FF%FE":"��"},n=At.exec(t);n;){try{e[n[0]]=decodeURIComponent(n[0])}catch(t){var i=Pt(n[0]);i!==n[0]&&(e[n[0]]=i)}n=At.exec(t)}e["%C2"]="�";for(var r=Object.keys(e),a=0;a<r.length;a++){var o=r[a];t=t.replace(new RegExp(o,"g"),e[o])}return t}(t)}};function St(t,e){return e.encode?e.strict?pt(t):encodeURIComponent(t):t}var _t={extract:function(t){var e=t.indexOf("?");return-1===e?"":t.slice(e+1)},parse:function(t,e){var n=function(t){var e;switch(t.arrayFormat){case"index":return function(t,n,i){e=/\[(\d*)\]$/.exec(t),t=t.replace(/\[\d*\]$/,""),e?(void 0===i[t]&&(i[t]={}),i[t][e[1]]=n):i[t]=n};case"bracket":return function(t,n,i){e=/(\[\])$/.exec(t),t=t.replace(/\[\]$/,""),e?void 0!==i[t]?i[t]=[].concat(i[t],n):i[t]=[n]:i[t]=n};default:return function(t,e,n){void 0!==n[t]?n[t]=[].concat(n[t],e):n[t]=e}}}(e=bt({arrayFormat:"none"},e)),i=Object.create(null);return"string"!=typeof t?i:(t=t.trim().replace(/^[?#&]/,""))?(t.split("&").forEach((function(t){var e=t.replace(/\+/g," ").split("="),r=e.shift(),a=e.length>0?e.join("="):void 0;a=void 0===a?null:wt(a),n(wt(r),a,i)})),Object.keys(i).sort().reduce((function(t,e){var n=i[e];return Boolean(n)&&"object"==typeof n&&!Array.isArray(n)?t[e]=function t(e){return Array.isArray(e)?e.sort():"object"==typeof e?t(Object.keys(e)).sort((function(t,e){return Number(t)-Number(e)})).map((function(t){return e[t]})):e}(n):t[e]=n,t}),Object.create(null))):i},stringify:function(t,e){!1===(e=bt({encode:!0,strict:!0,arrayFormat:"none"},e)).sort&&(e.sort=function(){});var n=function(t){switch(t.arrayFormat){case"index":return function(e,n,i){return null===n?[St(e,t),"[",i,"]"].join(""):[St(e,t),"[",St(i,t),"]=",St(n,t)].join("")};case"bracket":return function(e,n){return null===n?St(e,t):[St(e,t),"[]=",St(n,t)].join("")};default:return function(e,n){return null===n?St(e,t):[St(e,t),"=",St(n,t)].join("")}}}(e);return t?Object.keys(t).sort(e.sort).map((function(i){var r=t[i];if(void 0===r)return"";if(null===r)return St(i,e);if(Array.isArray(r)){var a=[];return r.slice().forEach((function(t){void 0!==t&&a.push(n(i,t,a.length))})),a.join("&")}return St(i,e)+"="+St(r,e)})).filter((function(t){return t.length>0})).join("&"):""},parseUrl:function(t,e){return{url:t.split("?")[0]||"",query:this.parse(this.extract(t),e)}}},Tt=function(){function t(n){e(this,t);var i=_t.parseUrl(n),r=i.query;this.original=n,this.id=r.videoID||r.playID,this.gameId=r.playGameID,this.channel=r.playChannel,this.simulcastAiringId=r.simulcastAiringId,this.source=r["x-source"],this.resumeTime=r.resumeTime,"sportscenter://x-callback-url/showWatch"===i.url||"sportscenter://x-callback-url/showWatchStream"===i.url?this.type=ot.airing:"sportscenter://x-callback-url/showVideo"===i.url&&(this.type=ot.vod)}return i(t,[{key:"toString",value:function(){return"<MediaItemIdentifier id:".concat(this.id,", gameId:").concat(this.gameId,", channel:").concat(this.channel,", source:").concat(this.source,">")}}],[{key:"forNetwork",value:function(t){return"sportscenter://x-callback-url/showWatchStream?playChannel=".concat(t)}}]),t}(),Et=function(){function t(){e(this,t)}return i(t,[{key:"getCountryCode",value:function(){}}]),t}(),Ct=function(t){function n(){return e(this,n),d(this,c(n).apply(this,arguments))}return u(n,t),i(n,[{key:"getCountryCode",value:function(){return"us"}}]),n}(Et),Mt=new function t(n,i,r){e(this,t),this.serviceUrl=n,this.apiKey=i,this.networkSortOrder=r}("https://web.archive.org/web/20201021044330/https://watch.graph.api.espn.com/api","d15c5790-7cb0-4fe1-8782-25f4698d0739",["espn_ppv","espn_dtc","espn1","espn2","espn3","espnu","sec","espnews","espndeportes","longhorn","goalline","buzzerbeater","secplus","acc","accextra","espn_free","bam_dtc"]),Ot=function(){function t(n){e(this,t),this.locationProvider=n||new Ct,this.configuration=Mt}return i(t,[{key:"getMediaItems",value:function(e,n){var i=this,r=this.locationProvider.getCountryCode().toUpperCase(),a=n||{fetchLiveLinear:!0,sourceType:null};return t.fetchMediaItems(e,r,a,this.configuration).then((function(t){if(n&&n.fetchLiveLinear&&1===t.length){var e=t[0],r=e.isOverLinear,a=e.network&&e.network.id;if(r&&a){var o=Tt.forNetwork(a);return i.getMediaItems([o])}}return t}))}},{key:"configuration",get:function(){return this._configuration},set:function(t){this._configuration=t}}],[{key:"fetchMediaItems",value:function(t,e,n,i){var r=t.map((function(t){return new Tt(t)})),a=i.serviceUrl,o=i.apiKey,s=i.networkSortOrder,u=r.map((function(t){return _(function(t,e,n,i){var r="",a="",o="";t.type===ot.vod?(r="VOD",o="{id name description authTypes language duration originalPublishDate expirationDate requiresLinearPlayback lastModifiedDate source { url authorizationType } image { url } tracking { name sportName leagueName } coverageType prerollSource:source(variant:PREROLL) { url authorizationType }ad { sport bundle } links { mobileShare } }",a="id:".concat(t.id)):(r="airing",o="{ id name shortName description mrss:adobeRSS authTypes requiresLinearPlayback status:type startDateTime endDateTime duration source(authorization: SHIELD) { url authorizationType hasEspnId3Heartbeats hasNielsenWatermarks hasPassThroughAds commercialReplacement startSessionUrl } network { id type name adobeResource } image { url } sport { name code uid } league { name uid } program { code categoryCode isStudio } seekInSeconds simulcastAiringId airingId tracking { nielsenCrossId1 trackingId } eventId packages { name } language tier feedName links { mobileShare } includeSponsor contentSource }",t.id?a='id:"'.concat(t.id,'"'):t.channel?(r="airings",a='networks:["'.concat(t.channel,'"],type:LIVE')):t.gameId&&(r="airings",a='eventId:"'.concat(t.eventId||t.gameId,'"')));var s="";return s="airings"===r?encodeURIComponent("{ ".concat(r,"(").concat(a,',countryCode:"').concat(i,'",deviceType:SETTOP,tz:"Z") ').concat(o," }")):encodeURIComponent("{ ".concat(r,"(").concat(a,',deviceType:SETTOP,tz:"Z") ').concat(o," }")),"".concat(e,"?apiKey=").concat(n,"&query=").concat(s)}(t,a,o,e)).then((function(t){return t.json()})).then((function(e){var i=e.data.airing,r=e.data.airings;if(r){var a=t.simulcastAiringId?function(e){return e.simulcastAiringId===t.simulcastAiringId}:function(){return!0};i=r.filter(a)[0]}var o=e.data.VOD,s=i||o;if(!s)throw new Error("No results found.");var u=ft.fromJson(s,t.type,n);return t.resumeTime&&(u.seekInSeconds=t.resumeTime),u})).catch((function(t){return A.warn(t),new Error("Failed to retrieve MediaItem.")}))}));return w.all(u).then((function(t){return function(t,e){var n=navigator.language;return t.sort((function(t,e){var n="PRIMARY"===t.tier?0:"SECONDARY"===t.tier?1:2,i="PRIMARY"===e.tier?0:"SECONDARY"===e.tier?1:2;return n<i?-1:n>i?1:0})).sort((function(t,n){var i=t.network&&t.network.id.toLowerCase()||"unknown",r=n.network&&n.network.id.toLowerCase()||"unknown",a=e.indexOf(i),o=e.indexOf(r);return-1===a&&(a=999),-1===o&&(o=999),a<o?-1:a>o?1:0})).sort((function(t,e){var i=t.language===n?0:1,r=e.language===n?0:1;return i<r?-1:i<r?1:0}))}(t.filter((function(t){return!(t instanceof Error)&&t instanceof ft})),s)}))}}]),t}();Ot.AuthorizationType=tt;var Dt=new function t(n){e(this,t),this.intervals=n}({intervals:{DEFAULT:2,ESPN_PLUS:0,ESPN_PLUS_MLB:0,ESPN_PLUS_NHL:0}}),Ut=function(){function t(){e(this,t),this.configuration=Dt}return i(t,[{key:"shouldPreroll",value:function(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=this.configuration.intervals.DEFAULT||0,r=(n||[]).filter((function(t){return t in e.configuration.intervals})).map((function(t){return e.configuration.intervals[t]}));0===r.length&&r.push(i);var a=Math.min.apply(Math,m(r));return a>0&&t.prerollCount>=a-1}},{key:"configuration",get:function(){return this._configuration},set:function(t){this._configuration=t}}],[{key:"prerollCount",get:function(){var t=localStorage.getItem("PrerollManager.prerollCount");try{return JSON.parse(t)||0}catch(t){return 0}},set:function(t){localStorage.setItem("PrerollManager.prerollCount",JSON.stringify(t))}}]),t}(),Nt=function(t){function n(){return e(this,n),d(this,c(n).apply(this,arguments))}return u(n,t),i(n,[{key:"configuration",get:function(){var t=U.shared.getConfiguration("preRoll",Dt);return A.debug("PrerollManager.getConfiguration ".concat(JSON.stringify(t))),t},set:function(t){y(c(n.prototype),"configuration",t,this,!0)}}],[{key:"prerollCount",get:function(){return Ut.prerollCount},set:function(t){Ut.prerollCount=t}}]),n}(Ut),Lt=function(t){function n(t){var i;return e(this,n),(i=d(this,c(n).call(this,t))).prerollManager=new Nt,i}return u(n,t),i(n,[{key:"getMediaItems",value:function(t,e){var i=e||{fetchLiveLinear:!0};return this.prerollManager.shouldPreroll([])&&(i.sourceType=nt),p(c(n.prototype),"getMediaItems",this).call(this,t,i).then((function(t){var e=t.filter((function(t){return t.source.type===nt})).length;return e>0?Nt.prerollCount=0:Nt.prerollCount+=t.length-e,t}))}},{key:"configuration",get:function(){var t=U.shared.getConfiguration("graphqlapi",Mt);return A.debug("MediaItemAPI.getConfiguration ".concat(JSON.stringify(t))),t},set:function(t){y(c(n.prototype),"configuration",t,this,!0)}}]),n}(Ot),Rt=function(){function t(n,i){e(this,t),this.partner=n,this.platform=i}return i(t,[{key:"checkAuthentication",value:function(){}},{key:"authenticate",value:function(t){}},{key:"deauthenticate",value:function(){}},{key:"isAuthenticated",get:function(){return!1},set:function(t){}},{key:"authenticatedIdentity",get:function(){return null},set:function(t){}},{key:"authenticatedProvider",get:function(){return null},set:function(t){}},{key:"preauthorizedResources",get:function(){return[]}}]),t}(),jt=function(){function t(n,i,r,a){e(this,t),this.id=n,this.name=i,this.logoUrl=r,this.websiteUrl=a}return i(t,[{key:"toString",value:function(){return"<AuthenticatedProvider id:".concat(this.id,", name:").concat(this.name,", logoUrl:").concat(this.logoUrl,", websiteUrl:").concat(this.websiteUrl,">")}}],[{key:"fromJson",value:function(e){return new t(e.id,e.name,e.logoUrl,e.websiteUrl,null,null)}}]),t}(),Ht=function(t){function n(t,i,r,a,o,s){var u;return e(this,n),(u=d(this,c(n).call(this,t,i,r,a))).isHomeBasedAuth=o,u.mvpdCMConfiguration=s,u}return u(n,t),i(n,null,[{key:"fromJson",value:function(t){return new n(t.id,t.name,t.logoUrl,t.websiteUrl,t.isHomeBasedAuth,t.mvpdCMConfiguration)}}]),n}(jt),zt=function(){function t(n,i){e(this,t),this.id=n,this.tier=i}return i(t,[{key:"toString",value:function(){return"<AuthenticatedPackage id:".concat(this.id,", tier:").concat(this.tier,">")}}],[{key:"fromJson",value:function(e){return new t(e.id,e.tier)}}]),t}(),xt=function t(n,i){e(this,t),this.success=n,this.payload=i},Bt=function t(n,i,r,a){e(this,t),this.authenticationType=n,this.authenticatedProvider=i,this.authenticatedIdentity=r,this.userInfo=a};var Ft="watchsdk.web_adobe_pass_authenticator.state",Jt=function(t,e){e.setItem(Ft,JSON.stringify(t))},Kt=new function t(n,i,r,a){e(this,t),this.preauthorizeNetworksEnabled=n,this.preauthorizeNetworks=i,this.preauthorizeNetworksMapping=r,this.adobeAuthErrorRegex=a}(!1,[],{},"^$|^null$|^noAuthz$|^[\\d]*.*UPDA$|^BAD_RESPONSE$"),Vt=function(t){function n(t,i,r,a){var o;e(this,n),(o=d(this,c(n).call(this,t,i))).configuration=Kt;var s=a||{},u=s.environment,l=void 0===u?n.Environment.PRODUCTION:u,f=s.errorEventHandlerName,p=void 0===f?"AEErrorHandler":f;o.accessEnabler=null,o.environment=l,o.errorEventHandlerName=p,o._resolveEntitlementLoaded=null,o._resolveCheckAuthenticationCompletions=[],o._resolveAuthenticate=null,o._resolveDeauthenticate=null,o._resolveAuthorization=null,o._resolvePreauthorizes=[],o._resolveAuthenticateMetadataDependencies={},o.delegate=null,o.providerDataSource=null,o.storage=localStorage,o._state={};try{var v=o.storage.getItem(Ft),y=JSON.parse(v);y.authenticatedProvider&&(y.authenticatedProvider=Ht.fromJson(y.authenticatedProvider)),y.authenticatedPackage&&(y.authenticatedPackage=zt.fromJson(y.authenticatedPackage)),o._state=y}catch(t){}return o._initialization=o.initialize(),window.tokenRequestFailed=o.tokenRequestFailed.bind(h(o)),o}return u(n,t),i(n,[{key:"checkAuthentication",value:function(){var t=this;return A.debug("AdobePassAuthenticator.checkAuthentication"),this.accessEnabler?new w((function(e){t._resolveCheckAuthenticationCompletions.push((function(t){e(t)})),t.accessEnabler.checkAuthentication()})):new w.reject(null)}},{key:"authenticate",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(A.debug("AdobePassClient.authenticate"),!this.accessEnabler)return new w.reject(null);var n=e&&e.redirectUrl||window.location.href;return new w((function(e){t._resolveAuthenticate=function(t){e(t)},t.accessEnabler.getAuthentication(n)}))}},{key:"deauthenticate",value:function(){var t=this;return A.debug("AdobePassAuthenticator.deauthenticate"),this.accessEnabler?new w((function(e){t._resolveDeauthenticate=function(t){e(t)},t.accessEnabler.logout()})):new w.reject(null)}},{key:"checkAuthorization",value:function(t){var e=this;if(A.debug("AdobePassClient.checkAuthorization ".concat(t)),-1===t.authTypes.indexOf(dt.mvpd)||!this.isAuthenticated){var n=new xt(!1);return w.resolve(n)}var i=t.mrss,r=this.authenticatedPackage&&this.authenticatedPackage.id;r&&(i=function(t,e,n){if(!t||!e||!n)return t;var i="</item></channel></rss>",r=-1;return-1!==(r=t.indexOf(i))&&-1===t.indexOf("shield:affiliateId")&&(t="".concat(t.slice(0,r))+"<shield:affiliateId>".concat(e,"</shield:affiliateId>")+"".concat(t.slice(r))),-1!==(r=t.indexOf(i))&&-1===t.indexOf("shield:airingId")&&-1!==t.indexOf("shield:affiliateId")&&(t="".concat(t.slice(0,r),"<shield:airingId>").concat(n,"</shield:airingId>").concat(t.slice(r))),t}(i,r,t.id));var a=i;return new w((function(t,n){e._resolveAuthorization=function(i){var r=i.token,a=i.resourceId,o=i.errorId,s=i.message;if(r||!o){var u={token:C.stringify(E.parse(r)),tokenType:"ADOBEPASS",resource:a},c=new Bt(dt.mvpd,e.authenticatedProvider,e.authenticatedIdentity,u),l=new xt(!0,c);t(l)}else n(new Error(s||o))},e.accessEnabler.getAuthorization(a)}))}},{key:"setProvider",value:function(t){this.accessEnabler.setSelectedProvider(t)}},{key:"initialize",value:function(){var t=this,e=this.environment,n=Wt[e],i=Xt[e];return Gt(n,i).then((function(e){return t.accessEnabler=e,w.resolve()})).then((function(){return new w((function(e){t._resolveEntitlementLoaded=e,t.bindAccessEnablerCallbacks()}))}))}},{key:"bindAccessEnablerCallbacks",value:function(){window.entitlementLoaded=this.entitlementLoaded.bind(this),window.setAuthenticationStatus=this.setAuthenticationStatus.bind(this),window.setMetadataStatus=this.setMetadataStatus.bind(this),window.displayProviderDialog=this.displayProviderDialog.bind(this),window.setConfig=this.setConfig.bind(this),window.sendTrackingData=this.sendTrackingData.bind(this),window.preauthorizedResources=this.handlePreauthorizedResources.bind(this),window.selectedProvider=this.selectedProvider.bind(this),window.setToken=this.setToken.bind(this),window[this.errorEventHandlerName]=this.handleAccessEnablerError.bind(this)}},{key:"entitlementLoaded",value:function(){A.debug("AdobePassAuthenticator.entitlementLoaded"),this.accessEnabler&&(this.accessEnabler.bind("errorEvent",this.errorEventHandlerName),this.accessEnabler.setRequestor("ESPN"),this._resolveEntitlementLoaded&&(this._resolveEntitlementLoaded(!0),this._resolveEntitlementLoaded=null))}},{key:"setAuthenticationStatus",value:function(t,e){var n=this;if(A.debug("AdobePassAuthenticator.setAuthenticationStatus",t,e),this.isAuthenticated=!!t,this.isAuthenticated){this.accessEnabler.getMetadata(qt.UPSTREAM_USER_ID);var i=[qt.PACKAGE_ID,qt.PACKAGE_TIER,qt.HBA_STATUS,qt.MVPD].map((function(t){return new w((function(e){n._resolveAuthenticateMetadataDependencies[t]=function(t){e(t)},n.accessEnabler.getMetadata(t)})).catch((function(t){return A.warn(t),null}))}));i.push(this._getPreauthorizedResources().then((function(t){n._state.preauthorizedResources=t}))),w.all(i).then((function(t){n._resolveCheckAuthenticationCompletions.forEach((function(t){t(n.isAuthenticated)})),n._resolveCheckAuthenticationCompletions=[],n._resolveAuthenticate&&(n._resolveAuthenticate(n.isAuthenticated),n._resolveAuthenticate=null)}))}else this.authenticatedIdentity=null,this.authenticatedPackage=null,this.authenticatedProvider=null,this.hbaStatus=null,this._state.preauthorizedResources=[],this._resolveCheckAuthenticationCompletions.forEach((function(t){t(n.isAuthenticated)})),this._resolveCheckAuthenticationCompletions=[],this._resolveDeauthenticate&&(this._resolveDeauthenticate(this.isAuthenticated),this._resolveDeauthenticate=null)}},{key:"setMetadataStatus",value:function(t,e,n){var i=this;switch(A.debug("AdobePassAuthenticator.setMetadataStatus",t,n),t){case qt.MVPD:var r=n;this.providerDataSource?this.providerDataSource.getProvider(r).then((function(e){var a=e.images||[],o=a.filter((function(t){return"COLOR_NEGATIVE"===t.rel})).map((function(t){return t.href}))[0],s=a.filter((function(t){return"BW_NEGATIVE"===t.rel})).map((function(t){return t.href}))[0]||o||a.map((function(t){return t.href}))[0];i.authenticatedProvider=new Ht(r,e.name,s,e.websiteUrl,i.hbaStatus,e.streamLimiting),i._resolveAuthenticateMetadata(t,n)})).catch((function(){i.authenticatedProvider=new Ht(r,r,null,null,null,null),i._resolveAuthenticateMetadata(t,n)})):(this.authenticatedProvider=new Ht(r,r,null,null,null,null),this._resolveAuthenticateMetadata(t,n));break;case qt.UPSTREAM_USER_ID:this.authenticatedIdentity=n,this._resolveAuthenticateMetadata(t,n);break;case qt.HBA_STATUS:this.hbaStatus="true"===n,this._resolveAuthenticateMetadata(t,n);break;case qt.PACKAGE_ID:case qt.PACKAGE_TIER:if(n){var a=this.authenticatedPackage||new zt(null,null);t===qt.PACKAGE_ID?a.id=n:t===qt.PACKAGE_TIER&&(a.tier=n),this.authenticatedPackage=a}this._resolveAuthenticateMetadata(t,n)}}},{key:"displayProviderDialog",value:function(t){var e=this;A.debug("AdobePassAuthenticator.displayProviderDialog",t),this.providerDataSource&&this.providerDataSource.getProviders().then((function(t){e.delegate&&e.delegate.selectProvider&&e.delegate.selectProvider(t)}))}},{key:"setConfig",value:function(){}},{key:"sendTrackingData",value:function(t,e){if("authenticationDetection"===t){var n={success:e[0],mvpd:e[1],guid:e[2],isTokenCached:e[3],deviceType:e[4],clientType:e[5],os:e[6]};A.debug("AdobePassAuthenticator.sendTrackingData",t,n)}}},{key:"handlePreauthorizedResources",value:function(t){A.debug("AdobePassAuthenticator.preauthorizedResources",t);var e=this._resolvePreauthorizes.shift();e&&e(t)}},{key:"selectedProvider",value:function(t){var e=t.MVPD,n=t.AE_State;A.debug("AdobePassAuthenticator.selectedProvider mvpd: ".concat(e,", aeState: ").concat(n))}},{key:"setToken",value:function(t,e){A.debug("Requested resource: ".concat(t," tokenResult: ").concat(e)),this._resolveAuthorization&&(this._resolveAuthorization({resourceId:t,token:e}),this._resolveAuthorization=null)}},{key:"handleAccessEnablerError",value:function(t){var e=t.errorId,n=t.message;switch(A.debug("AdobePassAuthenticator.handleAccessEnablerError errorId: ".concat(e,", message: ").concat(n)),e){case"Z100":A.error("Failure to authorize: ".concat(n));var i=this.configuration.adobeAuthErrorRegex,r=new RegExp(i).test(n)?"This channel is not part of your TV package.":n;this._resolveAuthorization&&(this._resolveAuthorization({errorId:e,message:r}),this._resolveAuthorization=null);break;case"N130":this.checkAuthentication()}}},{key:"tokenRequestFailed",value:function(){A.debug("AdobePassAuthenticator.tokenRequestFailed")}},{key:"_resolveAuthenticateMetadata",value:function(t,e){var n=this._resolveAuthenticateMetadataDependencies[t];n&&(n(e),delete this._resolveAuthenticateMetadataDependencies[t])}},{key:"_getPreauthorizedResources",value:function(){var t=this;A.debug("AdobePassAuthenticator._getPreauthorizedResources");var e=this.configuration,n=e.preauthorizeNetworksEnabled,i=e.preauthorizeNetworks,r=e.preauthorizeNetworksMapping;if(!1===n){var a=i;return Object.keys(r).forEach((function(t){var e=r[t];-1!==a.indexOf(t)&&-1===a.indexOf(e)&&a.push(e)})),w.resolve(a)}if(0===i.length||!0!==this.isAuthenticated)return w.resolve([]);if(!this.accessEnabler)return new w.reject(null);var o=function t(e,n){return e.length?[e.slice(0,n)].concat(m(t(e.slice(n),n))):[]}(i,5),s=[],u=o.map((function(e){return new w((function(n){s.push((function(t){n(t)})),t.accessEnabler.checkPreauthorizedResources(e)})).catch((function(){return[]}))}));return this._resolvePreauthorizes=s,w.all(u).then((function(t){return t.reduce((function(t,e){return t.concat(e)}),[])}))}},{key:"configuration",get:function(){return this._configuration},set:function(t){this._configuration=t}},{key:"isAuthenticated",get:function(){return"true"===this._state.isAuthenticated||!0===this._state.isAuthenticated},set:function(t){this._state.isAuthenticated=t,Jt(this._state,this.storage)}},{key:"authenticatedIdentity",get:function(){return this._state.authenticatedIdentity},set:function(t){if(!t)return delete this._state.authenticatedIdentity,void Jt(this._state,this.storage);this._state.authenticatedIdentity=t,Jt(this._state,this.storage)}},{key:"authenticatedPackage",get:function(){return this._state.authenticatedPackage},set:function(t){if(!t)return delete this._state.authenticatedPackage,void Jt(this._state,this.storage);this._state.authenticatedPackage=t,Jt(this._state,this.storage)}},{key:"authenticatedProvider",get:function(){return this._state.authenticatedProvider},set:function(t){if(!t)return delete this._state.authenticatedProvider,void Jt(this._state,this.storage);this._state.authenticatedProvider=t,Jt(this._state,this.storage)}},{key:"wasPreviouslyAuthenticated",get:function(){return"true"===this._state.wasPreviouslyAuthenticated||!0===this._state.wasPreviouslyAuthenticated}},{key:"preauthorizedResources",get:function(){return this.isAuthenticated?this._state.preauthorizedResources:[]}},{key:"isHomeBasedAuth",get:function(){return this.hbaStatus||!1}}]),n}(Rt),Gt=function(t,e){var n=window&&window.document;if(!n)return w.reject();if(window.Adobe&&window.Adobe.AccessEnabler){var i=new window.Adobe.AccessEnabler(e);return w.resolve(i)}return new w((function(i,r){var a=n.createElement("script");a.id=Yt,a.type="text/javascript",a.async=!0,a.src=t,a.addEventListener("load",(function(){var t=new window.Adobe.AccessEnabler(e);i(t)})),a.addEventListener("error",(function(){r()})),n.getElementsByTagName("head")[0].appendChild(a)}))};Vt.Environment={PRODUCTION:"production",STAGING:"staging"},Vt.EventType={PREAUTHORIZED:"preauthorized",NOT_PREAUTHORIZED:"not_preauthorized"};var qt={MVPD:"mvpd",UPSTREAM_USER_ID:"upstreamUserID",PACKAGE_ID:"packageId",PACKAGE_TIER:"tier",HBA_STATUS:"hba_status"},Wt={};Wt[Vt.Environment.PRODUCTION]="https://web.archive.org/web/20201021044330/https://entitlement.auth.adobe.com/entitlement/v4/AccessEnabler.js",Wt[Vt.Environment.STAGING]="https://web.archive.org/web/20201021044330/https://entitlement.auth-staging.adobe.com/entitlement/v4/AccessEnabler.js";var Yt="ae_js",Xt={};Xt[Vt.Environment.PRODUCTION]="eyJhbGciOiJSUzI1NiJ9.eyJzdWIiOiIyZGJmZWM4My03OWE1LTQyNzEtYTVmZC04NTZjYTMxMjRjNjMiLCJuYmYiOjE1NDAyMTI3NjEsImlzcyI6ImF1dGguYWRvYmUuY29tIiwiaWF0IjoxNTQwMjEyNzYxfQ.yaK3r4AI2uLVvsyN1GLzqzgzRlxMPtasSaiYYBV0wIstqih5tvjTmeoLmi8Xy9Kp_U7Md-bOffwiyK3srHkpUkhhwXLH2x6RPjmS1tPmhaG7-3LBcHTf2ySPvXhVf7cN4ngldawK4tdtLtsw6rF_JoZE2yaC6XbS2F51nXSFEDDnOQWIHEQRG3aYAj-38P2CLGf7g-Yfhbp5cKXeksHHQ90u3eOO4WH0EAjc9oO47h33U8KMEXxJbvjV5J8Va2G2fQSgLDZ013NBI3kQnE313qgqQh2feQILkyCENpB7g-TVBreAjOaH1fU471htSoGGYepcAXv-UDtpgitDiLy7CQ",Xt[Vt.Environment.STAGING]="eyJhbGciOiJSUzI1NiJ9.eyJzdWIiOiJhMmRjNjgyMC1kZGNkLTQ4NGEtOTdlNS0xZjJiZmQzOGI4YzgiLCJuYmYiOjE1NDAyMjIwNTksImlzcyI6ImF1dGguYWRvYmUuY29tIiwiaWF0IjoxNTQwMjIyMDU5fQ.YgX4ecGCgLCaZS7uwRQYZ8UR5EwT7GIl-glFbwU122bO1JYZSmbIX8YJSfmYth_scyeg-15BYWNftV9lOcmCe8VwIsQMJMIZKaF8qSIj5OfuTOBpNZNBpDAp5dC3zG7Zp1xLe3z-T0Y18-0BGj2yhGcJxBz4gtLXQ30Bw0LEIJ89nXCQaXFTq9N6zhDzMfkFJNnSNEvEmvcQqB4bFPIqn2is8427oQDU4D0XYvvTtx9eb5hmzKc9MbBG-8KRBA62BqdHomA5UA4kBYJKpe-8B2hO07Adi2bZoo5wP_VLNAnAxANWNXaGQYHMDjHDrHbbvuKHBudHgKxAuKpIdC7UrA";var Qt=function(t){function n(){return e(this,n),d(this,c(n).apply(this,arguments))}return u(n,t),i(n,[{key:"configuration",get:function(){var t=U.shared.getConfiguration("adobePass",Kt);return A.debug("WebAdobePassAuthenticator.getConfiguration ".concat(JSON.stringify(t))),t},set:function(t){y(c(n.prototype),"configuration",t,this,!0)}}]),n}(Vt),Zt={device:{advertisingId:"0000-0000-0000-0000-0000",devType:"web"}},$t={standard:"default",freeWheel:"fw",googleAdManager:"gam"},te={standard:"default",prod:"prod",development:"dev"},ee=function(t){return null===t?null:t?"1":"0"},ne=function(t,e){return null!=t?t:e},ie=function(){function t(){e(this,t),this.an="espn",this.descriptionUrl=null,this.fcap=null,this.hl=null,this.idType=null,this.isLat=!1,this.iu=null,this.msid=null,this.npa=!1,this.ppid=null,this.rdid=null,this.tfcd=!1,this.url=null,this.vpa=null,this.vpmute=null,this.authenticationProvider=null,this.bundleId=null,this.deviceOS=null,this.deviceType=null,this.isAutoplay=null,this.isMute=null,this.nielsenAppId=null,this.nielsenDeviceGroup=null,this.platform=null,this.stitchingProvider=null,this.swid=null,this.unid=null,this.videoDeliveryMethod=null,this.videoPlayerSize=null,this.userInfo={},this.adEnvironment=te.standard,this.adProvider=$t.standard}return i(t,[{key:"merge",value:function(t){return t?(this.an=t.an||this.an,this.descriptionUrl=t.descriptionUrl||this.descriptionUrl,this.fcap=t.fcap||this.fcap,this.hl=t.hl||this.hl,this.idType=t.idType||this.idType,this.isLat=ne(t.isLat,this.isLat),this.iu=t.iu||this.iu,this.msid=t.msid||this.msid,this.npa=ne(t.npa,this.npa),this.ppid=t.ppid||this.ppid,this.rdid=t.rdid||this.rdid,this.tfcd=ne(t.tfcd,this.tfcd),this.url=t.url||this.url,this.vpa=ne(t.vpa,this.vpa),this.vpmute=ne(t.vpmute,this.vpmute),this.authenticationProvider=t.authenticationProvider||this.authenticationProvider,this.bundleId=t.bundleId||this.bundleId,this.deviceOS=t.deviceOS||this.deviceOS,this.deviceType=t.deviceType||this.deviceType,this.isAutoplay=ne(t.isAutoplay,this.isAutoplay),this.isMute=ne(t.isMute,this.isMute),this.nielsenAppId=t.nielsenAppId||this.nielsenAppId,this.nielsenDeviceGroup=t.nielsenDeviceGroup||this.nielsenDeviceGroup,this.platform=t.platform||this.platform,this.stitchingProvider=t.stitchingProvider||this.stitchingProvider,this.swid=t.swid||this.swid,this.unid=t.unid||this.unid,this.videoDeliveryMethod=t.videoDeliveryMethod||this.videoDeliveryMethod,this.videoPlayerSize=t.videoPlayerSize||this.videoPlayerSize,this.userInfo?a(this.userInfo,t.userInfo):this.userInfo=t.userInfo,this.adEnvironment=t.adEnvironment!==te.standard?t.adEnvironment:this.adEnvironment,this.adProvider=t.adProvider!==$t.standard?t.adProvider:this.adProvider,this):this}},{key:"dictionaryForStartSession",value:function(){var t={};return t["ad.tfcd"]=ee(this.tfcd),t["ad.is_lat"]=ee(this.isLat),t["ad.idtype"]=this.idType,t["ad.rdid"]=this.rdid,t["ad.ppid"]=this.ppid||this.swid,t["ad.description_url"]=this.descriptionUrl,t["ad.hl"]=this.hl,t["ad.npa"]=ee(this.npa),t["ad.msid"]=this.msid,t["ad.an"]=this.an,t["ad.url"]=this.url,t.authp=this.authenticationProvider,t.bundleId=this.bundleId,t.devOS=this.deviceOS,t.devType=this.deviceType,t.fcap=this.fcap,t.isAutoplay=ee(this.isAutoplay),t.isMute=ee(this.isMute),t.nlsnAppID=this.nielsenAppId,t.plt=this.platform,t.swid=this.swid,t.unid=this.unid,t.vps=this.videoPlayerSize,this.adEnvironment!==te.standard&&(t.adEnv=this.adEnvironment),this.adProvider!==$t.standard&&(t.adProvider=this.adProvider),a(t,this.userInfo),Object.keys(t).forEach((function(e){return null===t[e]&&delete t[e]})),t}},{key:"dictionaryForBrightcove",value:function(){var t={};t.bundleId=this.bundleId,t.devOS=this.deviceOS,t.devType=this.deviceType,t.isAutoplay=ee(this.isAutoplay),t.isMute=ee(this.isMute),t.plt=this.platform,t.swid=this.swid,t.vps=this.videoPlayerSize,t.d_id=this.rdid,t.vdm=this.videoDeliveryMethod||"vod",t.stp=this.stitchingProvider||"brightcove";var e=Object.keys(t).filter((function(e){return null!==t[e]})).map((function(e){return"".concat(e,"=").concat(t[e])})).join("&"),n={};return n.UMADPARAMiu=this.iu,n.UMADPARAMis_lat=ee(this.isLat),n.UMADPARAMidtype=this.idType,n.UMADPARAMrdid=this.rdid,n.UMADPARAMppid=this.ppid||this.swid,n.UMADPARAMdescription_url=this.descriptionUrl,n.UMADPARAMhl=this.hl,n.UMADPARAMnpa=ee(this.npa),n.UMADPARAMmsid=this.msid,n.UMADPARAMan=this.an,n.UMADPARAMurl=this.url,n.UMADPARAMvpa=ee(this.vpa),n.UMADPARAMvpmute=ee(this.vpmute),n.UMPTPARAMcust_params=e,a(n,this.userInfo),Object.keys(n).forEach((function(t){return null===n[t]&&delete n[t]})),n}},{key:"dictionaryForAdEngine",value:function(){var t={};switch(t.sect=this.iu,t.npa=ee(this.npa),t.lat=ee(this.isLat),t.idtype=this.idType,t.devId=this.rdid,t.ppid=this.ppid||this.swid,t.app=this.an,t.tfcd=ee(this.tfcd),t.devOS=this.deviceOS,t.devType=this.deviceType,t.isAutoplay=ee(this.isAutoplay),t.isMute=ee(this.isMute),t.plt=this.platform,t.swid=this.swid,t.unid=this.unid,t.vps=this.videoPlayerSize,t.bundle=this.msid,t.hl=this.hl,t.UID=this.swid,t.vdm=this.videoDeliveryMethod,t.url=this.url,this.adEnvironment){case te.development:t.env="qa";break;case te.prod:t.env="prod"}switch(this.adProvider){case $t.freeWheel:t.ads="freewheel";break;case $t.googleAdManager:t.ads="google"}return a(t,this.userInfo),Object.keys(t).forEach((function(e){return null===t[e]&&delete t[e]})),t}}],[{key:"ppidForSwid",value:function(t){return t}}]),t}(),re=function(){function t(n,i,r){e(this,t),this.id=n,this.profile=i,this.preferences=r}return i(t,[{key:"toString",value:function(){return"<Fan id:".concat(this.id,">")}},{key:"favoriteSports",get:function(){return this.preferences.filter((function(t){return t.metadata.sportId&&!t.metadata.teamId})).map((function(t){return t.metadata}))}},{key:"favoriteTeams",get:function(){return this.preferences.filter((function(t){return t.metadata.teamInfo})).map((function(t){return t.metadata}))}},{key:"fantasyPreferences",get:function(){return this.preferences.filter((function(t){return 9===t.type.id}))}},{key:"isLeagueManager",get:function(){return this.preferences.some((function(t){var e=t.metadata&&t.metadata.entry&&t.metadata.entry;return e&&!0===e.isLeagueManager}))}}],[{key:"fromJson",value:function(e){if(!e)return null;var n=ae.fromJson(e.profile),i=e.preferences.map((function(t){return ue.fromJson(t)}));return new t(e.id,n,i)}}]),t}(),ae=function(){function t(n,i,r){e(this,t),this.isInsider=n,this.hasNotificationPreferences=i,this.settings=r}return i(t,[{key:"toString",value:function(){return"<FanProfile isInsider:".concat(this.isInsider,", hasNotificationPreferences:").concat(this.hasNotificationPreferences,">")}}],[{key:"fromJson",value:function(e){if(!e)return null;var n=oe.fromJson(e.settings);return new t(e.isInsider,e.hasNotificationPreferences,n)}}]),t}(),oe=function(){function t(n){e(this,t),this.videoAutoStart=n}return i(t,null,[{key:"fromJson",value:function(e){return e?new t(se.fromJson(e.videoAutoStart)):null}}]),t}(),se=function(){function t(n){e(this,t),this.value=n}return i(t,null,[{key:"fromJson",value:function(e){return e?new t(e.value):null}}]),t}(),ue=function(){function t(n,i,r){e(this,t),this.id=n,this.metadata=i,this.type=r}return i(t,null,[{key:"fromJson",value:function(e){if(!e)return null;var n=le.fromJson(e.metaData||e.metadata),i=ce.fromJson(e.type);return new t(e.id,n,i)}}]),t}(),ce=function(){function t(n,i,r){e(this,t),this.id=n,this.name=i,this.code=r}return i(t,null,[{key:"fromJson",value:function(e){return e?new t(e.id,e.name,e.code):null}}]),t}(),le=function(){function t(n,i,r,a){e(this,t),this.sportId=n,this.teamId=i,this.teamInfo=r,this.entry=a}return i(t,[{key:"uid",get:function(){if(this.teamInfo)return this.teamInfo.uid;var t=null;return this.sportId&&(t="s:".concat(this.sportId),this.teamId&&(t="".concat(t,"~t:").concat(this.teamId))),t}}],[{key:"fromJson",value:function(e){if(!e)return null;var n=null;if(e.teamInfo)n=new fe(e.teamInfo.uid,e.teamInfo.name,e.teamInfo.fullName,e.teamInfo.logoUrl,e.teamInfo.darkLogoUrl,e.teamInfo.scoreboardLogoUrl,e.teamInfo.scoreboardDarkLogoUrl);else if(e.team){var i=e.team,r=i.coreData.logos.filter((function(t){return-1!==t.rel.indexOf("default")})).map((function(t){return t.href}))[0],a=i.coreData.logos.filter((function(t){return-1!==t.rel.indexOf("dark")&&-1===t.rel.indexOf("scoreboard")})).map((function(t){return t.href}))[0],o=i.coreData.logos.filter((function(t){return-1!==t.rel.indexOf("scoreboard")&&-1===t.rel.indexOf("dark")})).map((function(t){return t.href}))[0],s=i.coreData.logos.filter((function(t){return-1!==t.rel.indexOf("scoreboard")&&-1!==t.rel.indexOf("dark")})).map((function(t){return t.href}))[0];n=new fe(i.uid,i.name,i.text,r,a||r,o||r,s||a||r)}var u=he.fromJson(e.entry);return new t(e.sportId,e.teamId,n,u)}}]),t}(),he=function(){function t(n){e(this,t),this.groups=n}return i(t,[{key:"isLeagueManager",get:function(){return this.groups.some((function(t){return!0===t.groupManager}))}}],[{key:"fromJson",value:function(e){return e?new t((e.groups||[]).map((function(t){return de.fromJson(t)}))):null}}]),t}(),de=function(){function t(){var n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];e(this,t),this.groupManager=n}return i(t,null,[{key:"fromJson",value:function(e){return e?new t(e.groupManager):null}}]),t}(),fe=function t(n,i,r,a,o,s,u){e(this,t),this.uid=n,this.name=i,this.fullName=r,this.logoUrl=a,this.darkLogoUrl=o,this.scoreboardLogoUrl=s,this.scoreboardDarkLogoUrl=u},pe="https://web.archive.org/web/20201021044330/https://fan.api.espn.com/apis/v2/fans",ve=function(){function t(){e(this,t),this.serviceUrl=pe}return i(t,[{key:"getFan",value:function(t){var e=$.platform,n=this.serviceUrl||pe;return _("".concat(n,"/").concat(encodeURIComponent(t),"?prefType=sports&prefType=teams&prefType=fantasy&coreData=logos"),{method:"GET",headers:{"X-Personalization-Source":"espn-watchsdk-js-".concat(e)}}).then((function(t){return t.json()})).then((function(t){return re.fromJson(t)}))}}]),t}(),ye=function(t){function n(){return e(this,n),d(this,c(n).apply(this,arguments))}return u(n,t),i(n,null,[{key:"getFan",value:function(t){var e=U.shared.getConfiguration("fanApi",{serviceUrl:pe}).serviceUrl,n=new ve;return n.serviceUrl=e,n.getFan(t)}}]),n}(ve);localStorage.getItem("FanManager.anonSwid")||_("https://web.archive.org/web/20201021044330/https://log.espn.com/log?srvc=sz&silent&returnBody=SWID&responseType=JSON").then((function(t){return t.json()})).then((function(t){var e=t.SWID;e&&localStorage.setItem("FanManager.anonSwid",e)}));var ge=function(){function t(){e(this,t)}return i(t,null,[{key:"swid",get:function(){return localStorage.getItem("FanManager.anonSwid")}}]),t}(),me=function(){function t(){e(this,t)}return i(t,null,[{key:"update",value:function(){var e=localStorage.getItem("FanManager.swid");return e?ye.getFan(e).then((function(t){return localStorage.setItem("FanManager.fan",JSON.stringify(t)),t})):w.resolve(t.fan)}},{key:"swid",get:function(){return localStorage.getItem("FanManager.swid")||ge.swid},set:function(t){if(!t)return localStorage.removeItem("FanManager.swid"),void localStorage.removeItem("FanManager.fan");localStorage.setItem("FanManager.swid",t)}},{key:"fan",get:function(){var t=localStorage.getItem("FanManager.fan");try{return re.fromJson(JSON.parse(t))}catch(t){return null}}}]),t}(),be="AuthenticationManager.advertisingId",ke=function(){function t(n){e(this,t),localStorage.removeItem(be),this.partner=null,this.platform=null,this.apiKey=null,this.deviceId=null,this.locationProvider=n||new Ct,this.authenticators={},this.authorizers={},this.playbackSessionFactories={}}return i(t,[{key:"getAuthenticator",value:function(t){return this.authenticators[t]}},{key:"setAuthenticator",value:function(t,e){this.authenticators[e]=t}},{key:"getAuthorizer",value:function(t){return this.authorizers[t]}},{key:"setAuthorizer",value:function(t,e){this.authorizers[e]=t}},{key:"getPlaybackSessionFactory",value:function(t){return this.playbackSessionFactories[t]}},{key:"setPlaybackSessionFactory",value:function(t,e){this.playbackSessionFactories[e]=t}},{key:"checkAuthentication",value:function(){var t=this,e=Object.keys(this.authenticators).map((function(e){var n=t.authenticators[e];return n.checkAuthentication().then((function(t){return A.debug("".concat(e," authenticator"),"isAuthenticated:",t,"authenticatedProvider:",n.authenticatedProvider),t})).catch((function(){return!1}))}));return w.all(e).then((function(t){return t.every((function(t){return!0===t}))}))}},{key:"isAuthenticatedForMediaItem",value:function(t){var e=this;return t.authTypes.length<1||-1!==t.authTypes.indexOf(dt.none)||t.authTypes.map((function(t){return e.authenticators[t]})).filter((function(t){return t})).some((function(t){return t.isAuthenticated}))}},{key:"isAuthenticatedWithAuthType",value:function(t){var e=this.authenticators[t];return!!e&&e.isAuthenticated}},{key:"authenticateWithAuthType",value:function(t,e){var n=this.authenticators[t];if(n)return n.authenticate(e)}},{key:"checkAuthorization",value:function(t,e){var n=this;if(t.authTypes.length<1||-1!==t.authTypes.indexOf(dt.none)){var i=new Bt(dt.none),r=new xt(!0,i);return w.resolve(r)}var a=[dt.open,dt.mvpd,dt.direct,dt.isp].filter((function(e){return-1!==t.authTypes.indexOf(e)})),o=a.map((function(t){return n.authorizers[t]||n.authenticators[t]})).filter((function(t){return t&&t.checkAuthorization}));return A.debug("mediaItem.authTypes:",a),0===o.length?w.reject(new Error("no authorizer configured to support authTypes: ".concat(t.authTypes))):function t(e,n,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],a=i.shift();return a.checkAuthorization(e,n).then((function(a){return a.success?a:i.length<1?r.length>0?w.reject(null):a:t(e,n,i,r)})).catch((function(a){if(i.length>0)return a&&r.push(a),t(e,n,i,r);var o=r[0]||a;if(o)throw o}))}(t,e,o)}},{key:"initPlaybackSession",value:function(t,e){var n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3?arguments[3]:void 0;if(!t.source.authorizationType&&t.authTypes.length>0)return w.reject(new Error("This event is not currently available."));var a=me.swid||ge.swid;return this.checkAuthorization(t,e).then((function(o){A.debug("AuthenticationManager.initPlaybackSession.checkAuthorization result:",o.success);var s=o.success,u=o.payload;if(!s)throw new Error("Not authorized.");var c=u.authenticationType;if(!c)throw new Error("Not authorized.");var l=n.playbackSessionFactories[c],h=new ie;return h.swid=a,h.platform=n.platform,h.authenticationProvider=o.authenticatedProvider&&o.authenticatedProvider.id,h.merge(e),l.initPlaybackSession(t,a,h,i,u,r).then((function(t){return A.debug("AuthenticationManager.initPlaybackSession",t),t}))}))}},{key:"authStates",get:function(){var t=this.authenticators[dt.mvpd],e=[];return this.authenticators[dt.isp].isAuthenticated&&e.push("isp"),!0===t.isAuthenticated?e.push("mvpd_login"):!0===t.wasPreviouslyAuthenticated&&e.push("mvpd_previous"),e}},{key:"preauthorizedResources",get:function(){var t=this;return Object.keys(this.authenticators).map((function(e){return t.authenticators[e].preauthorizedResources})).reduce((function(t,e){return t.concat(e)}),[]).filter((function(t,e,n){return n.indexOf(t)===e}))}},{key:"primaryAuthenticatedProvider",get:function(){var t=this;return[dt.mvpd,dt.isp].map((function(e){return t.getAuthenticator(e)})).filter((function(t){return t.isAuthenticated})).map((function(t){return t.authenticatedProvider}))[0]}},{key:"advertisingId",get:function(){var t=localStorage.getItem(be);return t||(t=Zt&&Zt.device.advertisingId,this.advertisingId=t),t},set:function(t){localStorage.setItem(be,t)}}]),t}();ke.AuthenticationType=dt,ke.AuthenticateOptionsKey={redirectUrl:"redirectUrl"};var Ae=function(){function t(n,i,r){e(this,t),this.limit=n,this.time=i,this.logout=r}return i(t,null,[{key:"fromJson",value:function(e){return new t(e.limit,e.time,e.logout)}}]),t}(),Ie=function(){function t(n,i){e(this,t),this.initialDelay=n,this.interval=i}return i(t,null,[{key:"fromJson",value:function(e){return new t(e.initialDelay,e.interval)}}]),t}(),Pe=function(){function t(n,i){e(this,t),this.initialDelay=n,this.interval=i}return i(t,null,[{key:"fromJson",value:function(e){return new t(e.initialDelay,e.interval)}}]),t}(),we=function(){function t(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"b4f48f3f-c6bd-4e5f-94a0-3e32fdc6000c",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Ae(3,2700,!0),a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Ie(0,30),o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new Pe(5,60);e(this,t),this.streamLimit=n,this.context=i,this.kickOut=r,this.heartbeat=a,this.statusCheck=o}return i(t,null,[{key:"fromJson",value:function(e){if(!e)return null;var n=e.streamLimit,i=e.context,r=e.kickOut,a=e.heartbeat,o=e.statusCheck;return new t(n,i,Ae.fromJson(r),Ie.fromJson(a),Pe.fromJson(o))}}]),t}(),Se=function(){function t(n,i,r,a,o,s,u,c,l){e(this,t),this.id=n,this.name=i,this.abbreviation=r,this.tier=a,this.streamLimiting=o,this.images=s||[],this.adobeId=u||r,this.rank=c,this.websiteUrl=l}return i(t,[{key:"getPreferredLogoUrl",value:function(t,e){var n=this.images.filter((function(t){return"COLOR_NEGATIVE"===t.rel})).map((function(t){return t.rel}))[0],i=this.images.filter((function(t){return"BW_NEGATIVE"===t.rel})).map((function(t){return t.rel}))[0]||n;return i?"https://web.archive.org/web/20201021044330/https://s.secure.espncdn.com/stitcher/watch/clients/".concat(t,"-").concat(e,"/providers/").concat(this.abbreviation,".png?height=40&imageType=").concat(i):this.images.filter((function(t){return"DESKTOP"===t.rel})).map((function(t){return t.href}))[0]||null}},{key:"toString",value:function(){return"<Provider id:".concat(this.id,", name:").concat(this.name,", abbreviation:").concat(this.abbreviation,">")}}],[{key:"fromJson",value:function(e){var n=e.id,i=e.name,r=e.abbreviation,a=e.tier,o=e.streamLimiting,s=e.tierRank,u=e.websiteUrl;return new t(n,i,r,a,we.fromJson(o),[],r,s,u)}}]),t}(),_e="adobe",Te="isp",Ee={negativebgcolorImage:"COLOR_NEGATIVE",negativebgbwImage:"BW_NEGATIVE",positivebgcolorImage:"COLOR_POSITIVE",positivebgbwImage:"BW_POSITIVE",desktop:"DESKTOP"},Ce={};Ce[_e]="adobeId",Ce[Te]="ispId";var Me=new function t(n){e(this,t),this.serviceUrl=n}("https://web.archive.org/web/20201021044330/https://affiliate.api.espn.com/affiliateApi/affiliates?includeProperties=true&rows=1000&apikey=q458c7hcllto16w0wcjytqoxq"),Oe=function(t,e){if(!t)return null;var n=t.id,i=t.name,r=t.adobeId,a=t.websiteUrl,o=t.streamLimiting,s=t.adobeId,u=t.countries.filter((function(t){return t.countryCode.toLowerCase()===e.toLowerCase()}))[0],c=u&&u.tier,l=u&&u.rank,h=new Se(n,i,r,c,o,[],s,l,a),d=t.logos;return h.images=Object.keys(d).filter((function(t){return Ee[t]&&!!d[t]})).map((function(t){return{href:d[t],rel:Ee[t]}})),h},De=function(t){return-1!==["PR","GU","VI"].indexOf(t)?"US":t},Ue=function(t){function n(){return e(this,n),d(this,c(n).apply(this,arguments))}return u(n,t),i(n,[{key:"configuration",get:function(){var t=U.shared.getConfiguration("provider",s({applicationKeyMap:{}},Me));return A.debug("WatchClientAPI.getConfiguration ".concat(JSON.stringify(t))),t},set:function(t){y(c(n.prototype),"configuration",t,this,!0)}},{key:"applicationId",get:function(){var t=function(t){return"US"===t||"GU"===t||"PR"===t||"VI"===t}(this.locationProvider.getCountryCode().toUpperCase())&&"web"===$.platform?"".concat($.partner,"_").concat($.platform):"".concat($.platform),e=this.configuration.applicationKeyMap||{};return e[t]&&(t=e[t]),A.debug("WatchClientAPI.getApplicationId ".concat(t)),t},set:function(t){y(c(n.prototype),"applicationId",t,this,!0)}}]),n}(function(){function t(n){e(this,t),this.locationProvider=n||new Ct,this.applicationId=null,this.configuration=Me}return i(t,[{key:"getProvider",value:function(t,e){var n={};return n[Ce[e||_e]||"adobeId"]=t,this.getProviders(n).then((function(t){var e=t[0];if(!e)throw new Error("Unable to find provider.");return e}))}},{key:"getProviders",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this.configuration.serviceUrl,n=-1===e.indexOf("?")?"?":"&",i=this.applicationId,r=De(this.locationProvider.getCountryCode().toUpperCase());i&&(t.application=i),t.country=r;var a=Object.keys(t).map((function(e){return"".concat(e,"=").concat(encodeURIComponent(t[e]))})).join("&"),o="".concat(e).concat(n).concat(a);return _(o).then((function(t){return t.json()})).then((function(t){return t.rows.map((function(t){return Oe(t.data,r)})).sort((function(t,e){var n=t.tier||99,i=e.tier||99;if(n<i)return-1;if(n>i)return 1;var r=t.rank||9999,a=e.rank||9999;if(r<a)return-1;if(r>a)return 1;var o=t.name.toLowerCase(),s=e.name.toLowerCase();return o<s?-1:o>s?1:0}))})).catch((function(){return[]}))}},{key:"configuration",get:function(){return this._configuration},set:function(t){this._configuration=t}},{key:"applicationId",get:function(){return this._applicationId},set:function(t){this._applicationId=t}}]),t}()),Ne={localStorage:"LOCAL_STORAGE",sessionStorage:"SESSION_STORAGE"},Le="watchsdk.isp_authenticator.state",Re=function(t,e){e.setItem(Le,JSON.stringify(t))},je=function(t){var e="true"===t.getItem("ISPAuthenticator.isAuthenticated"),n=t.getItem("ISPAuthenticator.authenticatedIdentity"),i=null;try{i=JSON.parse(t.getItem("ISPAuthenticator.authenticatedProvider"))}catch(t){}var r={isAuthenticated:e,authenticatedIdentity:n,authenticatedProvider:i};return t.removeItem("ISPAuthenticator.isAuthenticated"),t.removeItem("ISPAuthenticator.authenticatedIdentity"),t.removeItem("ISPAuthenticator.authenticatedProvider"),r},He=new function t(n){e(this,t),this.userDataServiceUrl=n}("https://web.archive.org/web/20201021044330/https://broadband.espn.com/espn3/auth/watchespn/user"),ze=function(t){function n(){return e(this,n),d(this,c(n).apply(this,arguments))}return u(n,t),i(n,[{key:"configuration",get:function(){var t=U.shared.getConfiguration("authorization",He);return A.debug("ISPAuthenticator.getConfiguration ".concat(JSON.stringify(t))),t},set:function(t){y(c(n.prototype),"configuration",t,this,!0)}}]),n}(function(t){function n(t,i,r){var a;switch(e(this,n),(a=d(this,c(n).call(this,t,i))).providerDataSource=null,a.configuration=He,r){case Ne.localStorage:a.storage=localStorage;break;case Ne.sessionStorage:a.storage=sessionStorage;break;default:a.storage=localStorage}a._state={};try{var o=a.storage.getItem(Le);o||(o=je(a.storage),Re(a._state,a.storage));var s=JSON.parse(o);s.authenticatedProvider&&(s.authenticatedProvider=jt.fromJson(s.authenticatedProvider)),a._state=s}catch(t){}return a}return u(n,t),i(n,[{key:"checkAuthentication",value:function(){var t=this;A.debug("ISPAuthenticator.checkAuthentication");var e=this.configuration.userDataServiceUrl;return _("".concat(e,"?partner=").concat(this.partner,"&platform=").concat(this.platform)).then((function(t){return t.json()})).then((function(e){var n=e.user&&e.user.authentication&&e.user.authentication.isp;if(n){t.isAuthenticated=!0;var i=n.name;return t.providerDataSource?t.providerDataSource.getProvider(i,Te).then((function(e){var n=e.getPreferredLogoUrl(t.partner,t.platform);return t.authenticatedProvider=new jt(i,e.name,n),!0})).catch((function(){return t.authenticatedProvider=new jt(i,i,null),!0})):(t.authenticatedProvider=new jt(i,i,null),w.resolve(!0))}return!1}))}},{key:"authenticate",value:function(){return w.resolve(!0)}},{key:"deauthenticate",value:function(){return this.isAuthenticated=!1,this.authenticatedProvider=null,this.authenticatedIdentity=null,w.resolve(!0)}},{key:"checkAuthorization",value:function(t){if(-1===t.authTypes.indexOf(dt.isp)||!this.isAuthenticated)return w.resolve(new xt(!1));var e=new Bt(dt.isp,this.authenticatedProvider,this.authenticatedIdentity,{token:"IA==",tokenType:"DEVICE"}),n=new xt(!0,e);return w.resolve(n)}},{key:"configuration",get:function(){return this._configuration},set:function(t){this._configuration=t}},{key:"isAuthenticated",get:function(){return"true"===this._state.isAuthenticated||!0===this._state.isAuthenticated},set:function(t){this._state.isAuthenticated=t,Re(this._state,this.storage)}},{key:"authenticatedIdentity",get:function(){return this._state.authenticatedIdentity},set:function(t){if(!t)return delete this._state.authenticatedIdentity,void Re(this._state,this.storage);this._state.authenticatedIdentity=t,Re(this._state,this.storage)}},{key:"authenticatedProvider",get:function(){return this._state.authenticatedProvider},set:function(t){if(!t)return delete this._state.authenticatedProvider,void Re(this._state,this.storage);this._state.authenticatedProvider=t,Re(this._state,this.storage)}},{key:"preauthorizedResources",get:function(){return this.isAuthenticated?["espn3"]:[]}}]),n}(Rt)),xe=function(t){function n(){return e(this,n),d(this,c(n).apply(this,arguments))}return u(n,t),i(n,[{key:"checkAuthentication",value:function(){return w.resolve(!0)}},{key:"authenticate",value:function(){return w.resolve(!0)}},{key:"deauthenticate",value:function(){return w.resolve(!0)}},{key:"checkAuthorization",value:function(t){if(-1===t.authTypes.indexOf(dt.open)||!this.isAuthenticated)return w.resolve(new xt(!1));var e=new Bt(dt.open,this.authenticatedProvider,this.authenticatedIdentity,{token:"IA==",tokenType:"DEVICE"}),n=new xt(!0,e);return w.resolve(n)}},{key:"isAuthenticated",get:function(){return!0},set:function(t){}},{key:"authenticatedIdentity",get:function(){return null},set:function(t){}},{key:"authenticatedProvider",get:function(){return null},set:function(t){}},{key:"preauthorizedResources",get:function(){return this.isAuthenticated?["espn_free"]:[]}}]),n}(Rt),Be=function(){function t(n,i,r,a,o,s){e(this,t),this.playbackUrl=n,this.mediaItem=i,this.seekToTime=r,this.authenticationType=a,this.authenticatedProvider=o,this.authenticatedIdentity=s,this.playbackConfig=null}return i(t,[{key:"toString",value:function(){return"<PlaybackSession playbackUrl:".concat(this.playbackUrl,", ")+"authenticationType:".concat(this.authenticationType,", ")+"authenticatedProvider:".concat(this.authenticatedProvider,">")}},{key:"convivaContentMetadata",get:function(){var t={};this.authenticationType&&(t.authType=this.authenticationType&&this.authenticationType.toLowerCase()||"free",this.authenticatedProvider&&this.authenticationType===dt.mvpd&&(t.mvpd=this.authenticatedProvider.id));var e={streamUrl:this.playbackUrl,custom:a(this.mediaItem.convivaContentMetadata.custom,t)};return a(this.mediaItem.tracking[lt.conviva],e)}}]),t}(),Fe=function(t){function n(t,i,r,a,o,s,u,l,h,f){var p;return e(this,n),(p=d(this,c(n).call(this,t,i,r,a,o,s))).airingId=u,p.token=l,p.simulcastAiringId=h,p.swid=f,p.concurrencyMonitorSessionId=null,p}return u(n,t),i(n,null,[{key:"fromJson",value:function(t){var e=t.session,i=e.event,r=i.airingId,a=i.simulcastAiringId,o=e.token;return new n(e.playbackUrls.default,null,null,null,null,null,r,o,a,null)}},{key:"fromObject",value:function(t){var e=ft.fromObject(t.mediaItem),i=new n(t.playbackUrl,e,t.seekToTime,t.authenticationType,t.authenticatedProvider,t.authenticatedIdentity,t.airingId,t.token,t.simulcastAiringId,t.swid);return i.concurrencyMonitorSessionId=t.concurrencyMonitorSessionId,i}}]),n}(Be),Je=function(t,e,n,i,r,a,o,s){var u=["partner=".concat(t),"platform=".concat(e),"token=".concat(encodeURIComponent(r)),"tokenType=".concat(a),"v=2.0.0","ttl=21600"];if(o){var c=C.stringify(E.parse(o));u.push("resource=".concat(encodeURIComponent(c)))}s&&Object.keys(s).forEach((function(t){u.push("".concat(t,"=").concat(encodeURIComponent(s[t])))}));var l=/swid=*/g;u.some((function(t){return l.test(t)}))||u.push("swid=".concat(encodeURIComponent(i)));return _(n,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},credentials:"include",body:u.join("&")}).then((function(t){return t.json()})).then((function(t){if(!t.session)throw new Error(t.message||"An unexpected error occurred. [".concat(t.abbreviation,"]"));var e=t.session,n=e.playbackUrls.default,i=e.fwSyncTokenUrl,r=e.adInsertionEnabled,a=Fe.fromJson(t);return i&&!0===r?_(i).then((function(t){return t.text()})).then((function(t){return a.playbackUrl="".concat(n,"&_fw_syncing_token=").concat(t),a})):a})).catch((function(t){if(t.message)throw new Error(t.message);return t.json().then((function(t){throw new Error(t.message||"An unexpected error occurred. [".concat(t.abbreviation,"]"))}))}))},Ke=function(){function t(){e(this,t)}return i(t,[{key:"initPlaybackSession",value:function(t,e,n){}}]),t}(),Ve=function t(n,i){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;e(this,t),this.contentType=n,this.protectionSystem=i,this.licenseUrl=r,this.certificateUrl=a},Ge=Ve.StreamProtection={none:"none",fairPlay:"fairplay",playReady:"playready",widevine:"widevine"},qe="ADOBEPASS",We=function(t,e,n,i,r,a,o,s){var u={swid:n};if(i&&(r===qe?u.adobeToken=i:u.token=i),a){var c=C.stringify(E.parse(a));u.adobeResource=c}o&&Object.keys(o).forEach((function(t){u[t]=o[t]})),u.swid||(u.swid=n),s&&(u.drmSupport=s);var l={method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},credentials:"include",body:Object.keys(u).map((function(t){return"".concat(t,"=").concat(encodeURIComponent(u[t]))})).join("&")},h="apikey=".concat(t),d=-1===e.indexOf("?")?"?":"&";return _("".concat(e).concat(d).concat(h),l).then((function(t){var e=t.status;if(!(e>=200&&e<300))throw t;return t.json().then((function(e){return[e,t.headers]}))})).then((function(t){var e=g(t,2),i=e[0],r=e[1];if(!i.stream){var a=i.message||"An unexpected error occurred.";throw new Error(a)}var o=i.stream,s=i.streamInfo,u=i.gatekeeperToken||r.get("_mediaAuth")||function(t){try{var e=document&&document.cookie.match("(^|;) ?"+t+"=([^;]*)(;|$)");return e?e[2]:null}catch(t){return null}}("_mediaAuth")||null,c=new Fe(o,null,null,null,null,null,null,u,null,n);if(s&&s.streamType){var l=s.licenseAcquisitionUrl,h=s.certificateUrl;switch(s.streamType){case"DASH_PLAYREADY":c.playbackConfig=new Ve("application/dash+xml",Ge.playReady,l);break;case"DASH_WIDEVINE":c.playbackConfig=new Ve("application/dash+xml",Ge.widevine,l);break;case"HLS_FAIRPLAY":c.playbackConfig=new Ve("application/x-mpegURL",Ge.fairPlay,null,h);break;case"HLS":c.playbackConfig=new Ve("application/x-mpegURL",Ge.none)}}return c})).catch((function(t){if(t instanceof Error)throw t;if(t.json)return t.json().then((function(t){var e=t.message||"An unexpected error occurred. [".concat(t.exception,"]");throw"com.espn.watch.api.AccessDeniedException"===t.exception&&(e="This content is not available for your package or region."),new Error(e)}))}))},Ye=function(t){function n(){return e(this,n),d(this,c(n).apply(this,arguments))}return u(n,t),i(n,null,[{key:"withConfiguration",value:function(t,e,i,a){var o,u=$.platform,c=t.applications&&t.applications[u],l=t.applicationId||c&&c.applicationId,h=new n("ESPN",l,e,i,s((r(o={},H,l),r(o,z,u),r(o,J,""),r(o,V,"false"),r(o,G,"ESPN"),o),a));return h.serviceUrl=t.serviceUrl,h.messages=t.messages||{},h}},{key:"fromPlaybackSession",value:function(t){var e;if(!t||t.authenticationType!==dt.mvpd)return null;var i=U.shared.getConfiguration("adobeCM",Y);if(!1===i.enabled)return null;var a=t.authenticatedProvider,o=t.mediaItem,s=t.authenticatedIdentity,u=a.id;if(!s||!u)return null;var c=(r(e={},j,s),r(e,x,o.network&&o.network.id),r(e,B,o.isLive?L:R),r(e,F,""),r(e,K,!!t.authenticatedProvider&&t.authenticatedProvider.isHomeBasedAuth),e);return n.withConfiguration(i,u,s,c)}}]),n}(W),Xe={none:"HLS",hlsFairplay:"HLS_FAIRPLAY",dashPlayReady:"DASH_PLAYREADY",dashWidevine:"DASH_WIDEVINE"},Qe=function t(n,i){e(this,t),this.shieldSupportedAuthTypes=n,this.preferredAuthzService=i},Ze=new Qe([dt.mvpd],tt.startSession),$e=function(t){function n(t,i,r,a){var o;return e(this,n),(o=d(this,c(n).call(this))).partner=t,o.platform=i,o.apiKey=r,o.locationProvider=a,o.configuration=Ze,o}return u(n,t),i(n,[{key:"initPlaybackSession",value:function(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],r=arguments.length>4?arguments[4]:void 0,a=arguments.length>5?arguments[5]:void 0;return this._getPlaybackSession(t,e,n,i,r,a).then((function(t){var e=Ye.fromPlaybackSession(t);return e?e.createSession().then((function(e){return t.concurrencyMonitorSessionId=e,t})):w.resolve(t)}))}},{key:"_getPlaybackSession",value:function(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],r=arguments.length>4?arguments[4]:void 0,a=arguments.length>5?arguments[5]:void 0,o=this.configuration,s=t.source.authorizationType;switch(s){case tt.none:return this._getVodClipPlaybackSession(t,e,n,i,r);case tt.startSession:var u=o.preferredAuthzService;A.debug("ESPNPlaybackSessionFactory.initPlaybackSession preferredAuthzService is ".concat(u));var c="".concat(t.id).match(/^\d+$/),l=o.shieldSupportedAuthTypes,h=-1!==l.indexOf(r.authenticationType);return c||!h?this._getAuthButlerSession(t,e,n,r):a?this._getShieldSession(t,e,n,r,a):u&&u!==tt.startSession&&u===tt.shield?this._getShieldSession(t,e,n,r,a):this._getAuthButlerSession(t,e,n,r);case tt.shield:return this._getShieldSession(t,e,n,r,a);case tt.bam:throw new Error("Unsupported AuthorizationType")}}},{key:"_getAuthButlerSession",value:function(t,e,n,i){var r=t.source.url;t.source.startSessionUrl&&t.source.authorizationType===tt.shield&&(r=t.source.startSessionUrl);try{var a=window&&window.location.protocol;a&&"https:"===a&&(r=r.replace(/^http(s?):/,a))}catch(t){}var o=i.userInfo,s=o.token,u=o.tokenType,c=o.resource,l=void 0===c?t.mrss:c;return Je(this.partner,this.platform,r,e,s,u,l,n.dictionaryForStartSession()).then((function(e){return e.mediaItem=t,e.seekToTime=t.seekInSeconds,e.authenticationType=i.authenticationType,e.authenticatedProvider=i.authenticatedProvider,e.authenticatedIdentity=i.authenticatedIdentity,e}))}},{key:"_getShieldSession",value:function(t,e,n,i,r){var a=t.source.url;if(t.source.authorizationType===tt.startSession){var o="watch.auth.api.espn.com";-1!==a.indexOf("qa.")&&(o="watch.auth.api.espnqa.com"),a="https://".concat(o,"/video/auth/media/").concat(t.id,"/asset")}try{var s=window&&window.location.protocol;s&&"https:"===s&&(a=a.replace(/^http(s?):/,s))}catch(t){}var u=i.userInfo,c=(u=void 0===u?{}:u).token,l=u.tokenType,h=u.resource,d=void 0===h?t.mrss:h,f=r||Xe.none,p=this.apiKey;return We(p,a,e,c,l,d,n.dictionaryForStartSession(),f).then((function(e){return e.mediaItem=t,e.seekToTime=t.seekInSeconds,e.authenticationType=i.authenticationType,e.authenticatedProvider=i.authenticatedProvider,e.authenticatedIdentity=i.authenticatedIdentity,e}))}},{key:"_getVodClipPlaybackSession",value:function(t,e,n,i,r){var a=t.source.url,o=t;if(t.source.type===nt){var s=n.dictionaryForBrightcove();Object.keys(s).forEach((function(t){a=tn(t,s[t],a)}))}else a=tn("SWID",e,a);A.debug(a,o);var u=new Be(a,o,o.seekInSeconds,r.authenticationType,r.authenticatedProvider,r.authenticatedIdentity);return w.resolve(u)}},{key:"configuration",get:function(){return this._configuration},set:function(t){this._configuration=t}}]),n}(Ke);$e.Configuration=Qe;var tn=function(t,e,n){var i=-1===n.indexOf("?")?"?":"&";return"".concat(n+i+t,"=").concat(encodeURIComponent(e))},en=function(t){function n(){return e(this,n),d(this,c(n).apply(this,arguments))}return u(n,t),i(n,[{key:"configuration",get:function(){var t=U.shared.getConfiguration("authorization",Ze);return A.debug("ESPNPlaybackSessionFactory.getConfiguration ".concat(JSON.stringify(t))),t},set:function(t){y(c(n.prototype),"configuration",t,this,!0)}}]),n}($e),nn=function(t){function n(t){var i;e(this,n),(i=d(this,c(n).call(this,t))).partner=$.partner,i.platform=$.platform,i.apiKey=$.apiKey,i.deviceId=$.deviceId;var r=new Ue(i.locationProvider),a=new Qt(i.partner,i.platform,i.deviceId);a.providerDataSource=r;var o="web"===i.platform?Ne.sessionStorage:Ne.localStorage,s=new ze(i.partner,i.platform,o);s.providerDataSource=r;var u=new xe(i.partner,i.platform);i.authenticators[dt.mvpd]=a,i.authenticators[dt.isp]=s,i.authenticators[dt.open]=u,i.authorizers[dt.mvpd]=a,i.authorizers[dt.isp]=s,i.authorizers[dt.open]=u;var l=new en(i.partner,i.platform,i.apiKey,t);return i.playbackSessionFactories[dt.mvpd]=l,i.playbackSessionFactories[dt.isp]=l,i.playbackSessionFactories[dt.open]=l,i.playbackSessionFactories[dt.none]=l,i}return u(n,t),n}(ke),rn={start:"start",playing:"playing",pause:"pause",seeking:"seeking",stalled:"stalled",stop:"stop",timedMetadata:"timedMetadata",currentTime:"currentTime"},an=function(){function t(n,i){e(this,t),this.mediaItem=n,this.mediaItemDataSource=i}return i(t,[{key:"start",value:function(){var t=this;this.mediaItem.streamType===st&&(this._intervalId=setInterval((function(){t._checkProgramChange()}),6e4))}},{key:"stop",value:function(){this._intervalId&&clearInterval(this._intervalId)}},{key:"_checkProgramChange",value:function(){var t=this;if(this.mediaItem){var e=this.mediaItem.network&&this.mediaItem.network.id,n=this.mediaItem.source.authorizationType;if(e&&n!==tt.bam){var i=Tt.forNetwork(e);this.mediaItemDataSource&&this.mediaItemDataSource.getMediaItems([i]).then((function(e){var n=e[0];n&&(t.mediaItem.id!==n.id&&t.mediaItem.simulcastAiringId!==n.simulcastAiringId&&(t.mediaItem=n,t.onProgramChange(n)))}))}}}},{key:"onProgramChange",value:function(t){}}]),t}(),on="PRIV",sn={heartbeat:"com.espn.authnet.heartbeat",transition:"com.espn.authnet.transition",nielsenWatermark:"www.nielsen.com"},un="COMMERCIAL",cn="SLATE",ln=function(){function t(n,i){e(this,t),this.type=n,this.id=i}return i(t,[{key:"isContent",get:function(){return this.type!==cn&&this.type!==un}}]),t}(),hn=function t(n,i,r){e(this,t),this.tag=n,this.owner=i,this.dataValue=r},dn=function(){function t(n,i){e(this,t),this.playerAdaptor=n,this.mediaItem=i,this._currentContentType=null,this._currentAdId=null,this._lastHeartbeatTime=null,this._initialHeartbeatTimer=null,this._heartbeatTimer=null,this._currentPlayerTime=0,this._initialPlayerTime=null,this._isPlaying=!1,this._handleStart=this._handleStart.bind(this),this.playerAdaptor.on(rn.start,this._handleStart),this._handlePlaying=this._handlePlaying.bind(this),this.playerAdaptor.on(rn.playing,this._handlePlaying),this._handlePaused=this._handlePaused.bind(this),this.playerAdaptor.on(rn.pause,this._handlePaused),this.playerAdaptor.on(rn.stalled,this._handlePaused),this.playerAdaptor.on(rn.seeking,this._handlePaused),this._handlePlayerCurrentTime=this._handlePlayerCurrentTime.bind(this),this.playerAdaptor.on(rn.currentTime,this._handlePlayerCurrentTime),this._handleTimedMetadata=this._handleTimedMetadata.bind(this),this.playerAdaptor.on(rn.timedMetadata,this._handleTimedMetadata),this._handleStop=this._handleStop.bind(this),this.playerAdaptor.on(rn.stop,this._handleStop)}return i(t,[{key:"onContentTypeChanged",value:function(t,e,n,i){}},{key:"stop",value:function(){this.playerAdaptor.off(rn.start),this.playerAdaptor.off(rn.playing),this.playerAdaptor.off(rn.pause),this.playerAdaptor.off(rn.stalled),this.playerAdaptor.off(rn.seeking),this.playerAdaptor.off(rn.timedMetadata),this.playerAdaptor.off(rn.currentTime),this.playerAdaptor.off(rn.stop)}},{key:"_handleStart",value:function(){if(A.debug("AdBreakMonitor._handleStart"),!0!==this.mediaItem.source.hasEspnId3Heartbeats)return A.debug("AdBreakMonitor._handleStart hasEspnId3Heartbeats !== true, setting currentContentType to content.",this._currentPlayerTime,this._initialPlayerTime,this.mediaItem.source.hasEspnId3Heartbeats),void(this.currentContentType=t.ContentType.content);this._scheduleInitialHeartbeatTimer()}},{key:"_handlePlaying",value:function(){this._isPlaying=!0}},{key:"_handlePaused",value:function(){this._isPlaying=!1}},{key:"_handleTimedMetadata",value:function(t){if(!0===this.mediaItem.source.hasEspnId3Heartbeats&&t.tag===on&&t.owner===sn.heartbeat){A.debug("AdBreakMonitor._handleTimedMetadata",JSON.stringify(t));var e=function(t){var e;try{e=JSON.parse(t.dataValue)}catch(t){return null}return e.length?e.map((function(t){return new ln(t.type,t.id)})):null}(t);e&&this._handleHeartbeats(e)}}},{key:"_handlePlayerCurrentTime",value:function(t){var e=Math.floor(t);null===this._initialPlayerTime&&(this._initialPlayerTime=e),this._currentPlayerTime=e}},{key:"_handleStop",value:function(){this._invalidateInitialHeartbeatTimer(),this._invalidateHeartbeatTimer()}},{key:"_handleHeartbeats",value:function(e){A.debug("AdBreakMonitor._handleHeartbeats",JSON.stringify(e)),this._invalidateInitialHeartbeatTimer(),this._lastHeartbeatTime=Date.now();var n=e.every((function(t){return t.isContent}))?t.ContentType.content:t.ContentType.ad;n===t.ContentType.ad&&(this._currentAdId=function(t){return t.find((function(t){return t.type===un&&null!==t.id}))||null}(e)),this.currentContentType=n,this._scheduleHeartbeatTimer()}},{key:"_scheduleInitialHeartbeatTimer",value:function(){var t=this;A.debug("AdBreakMonitor._scheduleInitialHeartbeatTimer"),this._invalidateInitialHeartbeatTimer(),this._initialHeartbeatTimer=setInterval((function(){t._handleInitialHeartbeatTimer()}),15e3)}},{key:"_invalidateInitialHeartbeatTimer",value:function(){this._initialHeartbeatTimer&&(clearInterval(this._initialHeartbeatTimer),this._initialHeartbeatTimer=null)}},{key:"_handleInitialHeartbeatTimer",value:function(){if(A.debug("AdBreakMonitor._handleInitialHeartbeatTimer"),this._invalidateInitialHeartbeatTimer(),!1!==this._isPlaying){if(!this.currentContentType){var e=t.ContentType.ad;this._currentAdId="1",this.currentContentType=e}}else this._scheduleInitialHeartbeatTimer()}},{key:"_scheduleHeartbeatTimer",value:function(){var t=this;this._invalidateHeartbeatTimer(),this._heartbeatTimer=setInterval((function(){t._handleHeartbeatTimer()}),1e4)}},{key:"_invalidateHeartbeatTimer",value:function(){this._heartbeatTimer&&(clearInterval(this._heartbeatTimer),this._heartbeatTimer=null)}},{key:"_handleHeartbeatTimer",value:function(){var e=Date.now();if(A.debug("AdBreakMonitor._handleHeartbeatTimer"),!1!==this._isPlaying){if(this._lastHeartbeatTime&&e-this._lastHeartbeatTime>2e4){A.debug("AdBreakMonitor._handleHeartbeatTimer [now - this._lastHeartbeatTime]: ",e-this._lastHeartbeatTime);var n=t.ContentType.ad;this._currentAdId="1",this.currentContentType=n}this._scheduleHeartbeatTimer()}else this._scheduleHeartbeatTimer()}},{key:"currentContentType",get:function(){return this._currentContentType},set:function(t){if(this._currentContentType!==t){var e=this._currentContentType;this._currentContentType=t;var n=this._currentPlayerTime;e||(n=this._initialPlayerTime||0),this.onContentTypeChanged&&this.onContentTypeChanged(t,e,n,this._currentAdId)}}}]),t}();dn.ContentType={ad:"ad",content:"content"};var fn={production:"PROD",testing:"TESTING"},pn={};pn[fn.production]="https://web.archive.org/web/20201021044330/https://cloudapi.imrworldwide.com/nmapi/v2",pn[fn.testing]="https://web.archive.org/web/20201021044330/https://sandbox-cloudapi.imrworldwide.com/nmapi/v2";var vn=function(){function t(n,i,r,a,o){var s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:fn.production;e(this,t);var u=n instanceof t.Configuration||n===Object(n)?n:new t.Configuration(n,i,r,a,o,s);A.debug("NielsenCloudAPIClient.constructor",JSON.stringify(u)),this.configuration=u,this.sessionId=P()}return i(t,[{key:"sendEvent",value:function(t,e,n,i,r){var a={devInfo:this.devInfo,metadata:{},event:t,position:isNaN(e)||null===e?"".concat(e):"".concat(Math.floor(e)),type:n,utc:"".concat(Date.now())};i&&(a.metadata.content=i.nielsenMetadata),n===dn.ContentType.ad&&(a.metadata.ad=r);var o="".concat(pn[this.env],"/").concat(this.appId,"/").concat(this.sessionId,"/a?b=").concat(encodeURIComponent(JSON.stringify(a)));A.debug("NielsenCloudAPIClient.sendEvent url:",o),A.debug("NielsenCloudAPIClient.sendEvent payload:",JSON.stringify(a)),_(o).then((function(t){A.debug("NielsenCloudAPIClient.sendEvent response.status: ".concat(t.status))})).catch((function(t){A.warn("NielsenCloudAPIClient.sendEvent response.error: ".concat(t&&t.message))}))}},{key:"closeSession",value:function(){this.sendEvent(t.EventType.delete,"","",null,null)}},{key:"configuration",set:function(t){t&&(this.appId=t.appId,this.devInfo={devId:!1===t.isOptOut?t.deviceId:"",apn:t.appName,apv:"".concat(t.appVersion),uoo:"".concat(t.isOptOut)},this.env=t.environment,this._configuration=t)},get:function(){return this._configuration}}]),t}();vn.AssetType={content:"content",ad:"ad"},vn.EventType={playhead:"playhead",complete:"complete",delete:"delete"},vn.Environment=fn,vn.Configuration=function t(n,i,r,a,o,s){e(this,t),this.appId=n,this.appName=i,this.appVersion=r,this.deviceId=a,this.isOptOut=o,this.environment=s};var yn=function(){function t(n,i,r){var a=this;e(this,t),this.cloudAPIClient=n,this.playerAdaptor=i;var o=ft.fromObject(r)||r;if(o.type===ot.airing){this.mediaItem=o,this.currentPlayerTime=null,this.lastContentBeaconTime=null,this._isPlayerPlaying=!1,this.playerAdaptor.on(rn.playing,(function(t){if(A.debug("NielsenTrackingManager PlayerAdaptorEvent.playing"),t){var e=Math.floor(t);a.currentPlayerTime=e}a.isPlayerPlaying=!0})),this.playerAdaptor.on(rn.seeking,(function(){A.debug("NielsenTrackingManager PlayerAdaptorEvent.seeking"),a.isPlayerPlaying=!1})),this.playerAdaptor.on(rn.pause,(function(){A.debug("NielsenTrackingManager PlayerAdaptorEvent.pause"),a.isPlayerPlaying=!1})),this.playerAdaptor.on(rn.currentTime,(function(t){var e=Math.floor(t);a.currentPlayerTime=e;var n=a.currentContentType;if(n&&a.isPlayerPlaying){var i=e-a.currentContentStartTime;0!==i&&i%10==0&&e!==a.lastContentBeaconTime&&e>a.lastContentBeaconTime&&(a.lastContentBeaconTime=e,A.debug("NielsenTrackingManager PlayerAdaptorEvent.currentTime sending playhead 10 second beacon",e),a._sendPlayheadEvent(n,e))}})),this.playerAdaptor.on(rn.stop,(function(){a.stop()})),this.currentContentType=null,this.currentContentStartTime=0,this.totalAdTime=0,this.currentAdInfo=null;var s=new dn(i,r);s.onContentTypeChanged=function(t,e,n){if(A.debug("NielsenTrackingManager adBreakMonitor.onContentTypeChanged from",e,"to",t),e){A.debug("NielsenTrackingManager adBreakMonitor.onContentTypeChanged sending playhead before contentType change");var i=a._getPlayheadPosition(e,n,!0);a.cloudAPIClient.sendEvent(vn.EventType.playhead,i,e,a.mediaItem,a.currentAdInfo)}A.debug("NielsenTrackingManager adBreakMonitor.onContentTypeChanged sending playhead after contentType change");var r=e&&!a.mediaItem.isLive?0:a._getPlayheadPosition(t,n),o=t===dn.ContentType.ad?{assetid:"1",type:0===r?"preroll":"midroll"}:null;a.cloudAPIClient.sendEvent(vn.EventType.playhead,r,t,a.mediaItem,o),a.currentContentType=t,a.currentContentStartTime=n,a.currentAdInfo=o,a.lastContentBeaconTime=n},this.adBreakMonitor=s}}return i(t,[{key:"stop",value:function(){this.playerAdaptor.off(rn.currentTime),this.playerAdaptor.off(rn.stop),this.adBreakMonitor&&this.adBreakMonitor.stop(),this.mediaItem=null}},{key:"_getPlayheadPosition",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.mediaItem.isLive)return Math.floor(Date.now()/1e3);if(t===dn.ContentType.ad){if(n){var i=e-this.currentContentStartTime;return this.totalAdTime=this.totalAdTime+i,i}return 0}return e-this.totalAdTime}},{key:"_sendPlayheadEventForCurrentPlayerTimeAndContentType",value:function(){var t=this.currentPlayerTime,e=this.currentContentType;e&&t!==this.lastContentBeaconTime&&t>this.lastContentBeaconTime&&(this.lastContentBeaconTime=t,A.debug("NielsenTrackingManager _sendPlayheadEventForCurrentPlayerTimeAndContentType sending playhead beacon",t),this._sendPlayheadEvent(e,t))}},{key:"_sendPlayheadEvent",value:function(t,e){var n=e-this.currentContentStartTime,i=t!==dn.ContentType.ad||this.mediaItem.isLive?this._getPlayheadPosition(t,e):n,r=t===dn.ContentType.ad?this.currentAdInfo:null;this.cloudAPIClient.sendEvent(vn.EventType.playhead,i,t,this.mediaItem,r)}},{key:"mediaItem",get:function(){return this._mediaItem},set:function(t){if(this._mediaItem){this._sendPlayheadEventForCurrentPlayerTimeAndContentType();var e=this._getPlayheadPosition(dn.ContentType.content,this.currentPlayerTime);A.debug("NielsenTrackingManager setMediaItem sending complete"),this.cloudAPIClient.sendEvent(vn.EventType.complete,e,vn.AssetType.content,this._mediaItem)}this._mediaItem=t,this.adBreakMonitor&&(this.adBreakMonitor.mediaItem=t)}},{key:"isPlayerPlaying",get:function(){return this._isPlayerPlaying},set:function(t){t!==this._isPlayerPlaying&&(this._isPlayerPlaying=t,this._sendPlayheadEventForCurrentPlayerTimeAndContentType())}}]),t}(),gn=function(){function t(n,i,r){e(this,t),this.streamId=n,this.streamStart=i,this.heartbeatUrl=r}return i(t,null,[{key:"fromJson",value:function(e){if(!e)return null;var n=e._links.heartbeat.href;return new t(e.streamId,e.streamStart,n)}}]),t}(),mn="alive",bn="stop",kn=new function t(n,i,r,a,o,s,u,c,l){e(this,t),this.enabled=n,this.applicationId=i,this.initiator=r,this.programmer=a,this.serviceUrl=o,this.errorLimit=s,this.streamLimitReachedMessage=u,this.errorLimitReachedMessage=c,this.loggedOutMessage=l}(!0,"b4f48f3f-c6bd-4e5f-94a0-3e32fdc6000c","ESPN","ESPN","https://web.archive.org/web/20201021044330/https://streams.adobeprimetime.com/v1",3,"The maximum number of concurrent streams has been reached on your account. If you have any questions or need assistance please visit es.pn/watchfaq or call 888-549-ESPN.","The maximum number of concurrent streams has been reached on your account. If you have any questions or need assistance please visit es.pn/watchfaq or call 888-549-ESPN. [code: elr]","You have been logged out. The maximum number of concurrent streams has been reached on your account. If you have any questions or need assistance please visit es.pn/watchfaq or call 888-549-ESPN."),An=function(t){function n(){return e(this,n),d(this,c(n).apply(this,arguments))}return u(n,t),i(n,[{key:"configuration",get:function(){var t=U.shared.getConfiguration("adobeMaiTai",kn),e=$.platform,n=t.applications&&t.applications[e],i=t.applicationId||n&&n.applicationId;return i&&(t.applicationId=i),A.debug("AdobeConcurrencyMonitor.getConfiguration ".concat(JSON.stringify(t))),t},set:function(t){y(c(n.prototype),"configuration",t,this,!0)}}],[{key:"fromPlaybackSession",value:function(t){if(t.authenticationType!==dt.mvpd)return null;var e=t.authenticatedIdentity,i=t.authenticatedProvider;if(!i)return null;var r=i.mvpdCMConfiguration;return e&&r?!1===U.shared.getConfiguration("adobeMaiTai",kn).enabled?null:new n(e,i.id,r):null}}]),n}(function(){function t(n,i,r){e(this,t),this.upstreamUserId=n,this.mvpd=i,this.mvpdConfiguration=r||new we,this.configuration=kn,this._errorCount=0,this._stream=null}return i(t,[{key:"start",value:function(){var t=this;if(this._errorCount=0,this._stream=null,this.upstreamUserId&&this.mvpd&&this.mvpdConfiguration.streamLimit){var e=this.configuration,n=e.serviceUrl,i=e.applicationId,r=e.programmer,a=e.initiator;return _("".concat(n,"/").concat(i,"/").concat(this.mvpd,"/accounts/").concat(this.upstreamUserId,"/streams")+"?initiator=".concat(a,"&programmer=").concat(r),{method:"POST"}).then((function(t){return t.json()})).then((function(e){var n=gn.fromJson(e);if(A.debug("AdobeConcurrencyMonitor.start stream:",JSON.stringify(n)),n)return t._stream=n,t._startHeartbeat(),t._startStatusCheck(),t.sessionId})).catch((function(t){A.warn("AdobeConcurrencyMonitor.start error:",t)}))}}},{key:"stop",value:function(){this._stopHeartbeat(),this._reset()}},{key:"_startHeartbeat",value:function(){var t=this,e=this.mvpdConfiguration.heartbeat.interval,n=this.mvpdConfiguration.heartbeat.initialDelay,i=this._stream.heartbeatUrl.replace("{event}",mn);this._heartbeatIntervalId=setTimeout((function(){t._heartbeatIntervalId=setInterval((function(){A.debug("AdobeConcurrencyMonitor._startHeartbeat fired");_(i,{method:"POST"}).catch((function(e){A.warn("AdobeConcurrencyMonitor._startHeartbeat error:",e),t._handleError(e)}))}),1e3*e)}),1e3*n)}},{key:"_stopHeartbeat",value:function(){var t=this._stream&&this._stream.heartbeatUrl;if(t){_(t.replace("{event}",bn),{method:"POST"})}}},{key:"_startStatusCheck",value:function(){var t=this,e=this.configuration,n=e.serviceUrl,i=e.applicationId,r=e.programmer,a="".concat(n,"/").concat(i,"/").concat(this.mvpd,"/accounts/").concat(this.upstreamUserId,"/streams")+"?programmer=".concat(r,"&status=active"),o=this.mvpdConfiguration.statusCheck.interval,s=this.mvpdConfiguration.statusCheck.initialDelay;this._statusCheckIntervalId=setTimeout((function(){t._statusCheckIntervalId=setInterval((function(){A.debug("AdobeConcurrencyMonitor._startStatusCheck fired"),_(a).then((function(t){return t.json()})).then((function(e){var n=e._embedded.streams,i=n.reduce((function(e,n){return n.streamStart>t._stream.streamStart?e+1:e}),1);if(A.debug("AdobeConcurrencyMonitor._startStatusCheck rank",i,"of",n.length),i>t.mvpdConfiguration.streamLimit){var r=!0===t.mvpdConfiguration.kickOut.logout&&t.kickOutCount>=t.mvpdConfiguration.kickOut.limit,a=r?t.configuration.loggedOutMessage:t.configuration.streamLimitReachedMessage,o=new Error(a);A.debug("AdobeConcurrencyMonitor._startStatusCheck calling onError with message:",a),t.onError(o,r)}})).catch((function(t){A.debug("AdobeConcurrencyMonitor._startStatusCheck error:",t)}))}),1e3*o)}),1e3*s)}},{key:"_handleError",value:function(){if(this._errorCount+=1,this._errorCount>=this.configuration.errorLimit){var t=new Error(this.configuration.errorLimitReachedMessage);this.onError(t,!1)}}},{key:"_reset",value:function(){this._heartbeatIntervalId&&clearInterval(this._heartbeatIntervalId),this._statusCheckIntervalId&&clearInterval(this._statusCheckIntervalId),this._errorCount=0,this._stream=null}},{key:"onError",value:function(t,e){A.debug("AdobeConcurrencyMonitor.onError"),A.debug("error: ".concat(t)),A.debug("shouldLogout: ".concat(e))}},{key:"configuration",get:function(){return this._configuration},set:function(t){this._configuration=t}},{key:"sessionId",get:function(){return this._stream&&this._stream.streamId}},{key:"kickOutCount",get:function(){var t="AdobeConcurrencyMonitor.kickOutLog|".concat(this.mvpd,"|").concat(this.upstreamUserId),e=[];try{e=JSON.parse(localStorage.getItem(t))||[]}catch(t){}var n=this.mvpdConfiguration.kickOut.time,i=Date.now();return(e=e.filter((function(t){return t>=i-1e3*n}))).push(i),localStorage.setItem(t,JSON.stringify(e)),e.length}}]),t}()),In=new function t(n){e(this,t),this.shieldApiKey=n}("mbmhfdgflphg14wss50rny3ct"),Pn=function(t){function n(t,i,r,a){e(this,n);var o=$.apiKey;return d(this,c(n).call(this,t,i,r,a,{shieldApiKey:o}))}return u(n,t),n}(function(){function t(n,i,r,a,o){var s=this;e(this,t),this.session=Fe.fromObject(n)||n,this.playerAdaptor=i,this.locationProvider=r||new Ct,this.nielsenTrackingManager=a,this.configuration=o||In,this.initConcurrencyMonitor(),this.initProgramChangeMonitor(),this.playerAdaptor.on(rn.start,(function(){A.debug("PlaybackManager.start"),s.programChangeMonitor.start()})),this.playerAdaptor.on(rn.timedMetadata,(function(t){})),this.playerAdaptor.on(rn.currentTime,(function(t){})),this.playerAdaptor.on(rn.stop,(function(){A.debug("PlaybackManager.stop"),s.cleanup()}))}return i(t,[{key:"initConcurrencyMonitor",value:function(){var t=this,e=this.session,n=null;e.concurrencyMonitorSessionId?(n=Ye.fromPlaybackSession(e))&&n.startWithSession(e.concurrencyMonitorSessionId):(n=An.fromPlaybackSession(e))&&n.start(),n&&(n.onError=function(e,n){t.playerAdaptor.stop(e),t.onStop(e),n&&t.onDeauthenticate(dt.mvpd)},this.adobeConcurrencyMonitor=n)}},{key:"initProgramChangeMonitor",value:function(){var t=this,e=this.configuration.shieldApiKey,n=new Lt(this.locationProvider),i=new an(this.session.mediaItem,n);i.onProgramChange=function(n){var i=n.source.url;if(n.source.authorizationType===tt.startSession){var r="watch.auth.api.espn.com";-1!==i.indexOf("qa.")&&(r="watch.auth.api.espnqa.com"),i="https://".concat(r,"/video/auth/media/").concat(n.id,"/asset")}var a=t.session.swid,o=t.session.token,s=n.mrss;o?We(e,i,a,o,"GATEKEEPER",s,null,drmSupport).then((function(e){e&&(e.mediaItem=n,e.seekToTime=t.session.seekToTime,e.authenticationType=t.session.authenticationType,e.authenticatedProvider=t.session.authenticatedProvider,e.authenticatedIdentity=t.session.authenticatedIdentity,e.swid=t.session.swid,t.session=e,t.nielsenTrackingManager&&(t.nielsenTrackingManager.mediaItem=e.mediaItem),t.onUpdatedMediaItem(e.mediaItem))})).catch((function(e){t.playerAdaptor.stop(e),t.onStop(e)})):A.warn("token missing. skipping program change re-auth.")},this.programChangeMonitor=i}},{key:"cleanup",value:function(){A.debug("PlaybackManager.cleanup"),this.playerAdaptor.off(rn.start),this.playerAdaptor.off(rn.timedMetadata),this.playerAdaptor.off(rn.stop),this.adobeConcurrencyMonitor&&this.adobeConcurrencyMonitor.stop(),this.programChangeMonitor&&this.programChangeMonitor.stop(),this.nielsenTrackingManager&&this.nielsenTrackingManager.stop()}},{key:"onDeauthenticate",value:function(t){}},{key:"onUpdatedMediaItem",value:function(t){}},{key:"onStop",value:function(t){}}]),t}());function wn(){}wn.prototype={on:function(t,e,n){var i=this.e||(this.e={});return(i[t]||(i[t]=[])).push({fn:e,ctx:n}),this},once:function(t,e,n){var i=this;function r(){i.off(t,r),e.apply(n,arguments)}return r._=e,this.on(t,r,n)},emit:function(t){for(var e=[].slice.call(arguments,1),n=((this.e||(this.e={}))[t]||[]).slice(),i=0,r=n.length;i<r;i++)n[i].fn.apply(n[i].ctx,e);return this},off:function(t,e){var n=this.e||(this.e={}),i=n[t],r=[];if(i&&e)for(var a=0,o=i.length;a<o;a++)i[a].fn!==e&&i[a].fn._!==e&&r.push(i[a]);return r.length?n[t]=r:delete n[t],this}};var Sn=wn,_n=wn;Sn.TinyEmitter=_n;var Tn=function(t){function n(t){var i;return e(this,n),(i=d(this,c(n).call(this))).nativePlayer=t,i}return u(n,t),i(n,[{key:"stop",value:function(t){}},{key:"cleanup",value:function(){}}]),n}(Sn),En=function(t){function n(){return e(this,n),d(this,c(n).call(this))}return u(n,t),n}(Sn),Cn={willStartPlaying:"atv.player.willStartPlaying",didStopPlaying:"atv.player.didStopPlaying",onTimedMetadataChanged:"atv.player.onTimedMetadataChanged",playerStateChanged:"atv.player.playerStateChanged",playerTimeDidChange:"atv.player.playerTimeDidChange"},Mn=function(){function t(n,i){e(this,t),this.certificateUrl=i,this.requests=[],this.bindSecureKeyDelivery(n||atv.secureKeyDelivery)}return i(t,[{key:"bindSecureKeyDelivery",value:function(t){t.fetchCertificate=this.fetchCertificate.bind(this),t.fetchAssetID=this.fetchAssetID.bind(this),t.fetchKeys=this.fetchKeys.bind(this),t.cancelAllRequests=this.cancelAllRequests.bind(this)}},{key:"fetchCertificate",value:function(t,e){var n=this;A.debug("VdmsSecureKeyDelivery.fetchCertificate",t);var i=this.certificateUrl;if(i){var r=new XMLHttpRequest;r.open("GET",i),r.onreadystatechange=function(){if(4===r.readyState){if(200===r.status){var t=r.responseDataAsBase64;A.debug("VdmsSecureKeyDelivery.fetchCertificate responseDataAsBase64:",t),e.success(t)}else e.failure(r.status);n.requests.splice(n.requests.indexOf(r),1)}},this.requests.push(r),r.send(null)}else e.failure("invalid certificate url")}},{key:"fetchAssetID",value:function(t,e){var n=/[?&]c=([^&]+)&*/.exec(t);if(!n||n.length<2)e.failure("Error parsing assetId ".concat(t));else{var i=n[1];A.debug("VdmsSecureKeyDelivery.fetchAssetID",t,i),e.success(i,!1)}}},{key:"fetchKeys",value:function(t,e,n){var i=this,r=t.replace("skd://","https://"),a=JSON.stringify({spc:e});A.debug("VdmsSecureKeyDelivery.fetchKeys",r);var o=new XMLHttpRequest;o.open("POST",r),o.setRequestHeader("Content-Type","application/json"),o.onreadystatechange=function(){if(4===o.readyState){if(200===o.status)try{var t=JSON.parse(o.responseText).ckc;n.success(t)}catch(t){n.failure("invalid JSON")}else n.failure(o.status);i.requests.splice(i.requests.indexOf(o),1)}},this.requests.push(o),o.send(a)}},{key:"cancelAllRequests",value:function(){A.debug("VdmsSecureKeyDelivery.cancelAllRequests",this.requests.length),this.requests.forEach((function(t){t.abort&&t.abort()})),this.requests=[]}}]),t}(),On=function(t){function n(t,i,r){var a;if(e(this,n),a=d(this,c(n).call(this,t)),!i)throw new Error("bus must be supplied");return a.bus=i,a.secureKeyDelivery=new Mn(r),a.playbackConfig=null,i.on(Cn.willStartPlaying,(function(){atv.player.observeTimedMetadataKeys(),a.emit(rn.start)})),i.on(Cn.playerStateChanged,(function(t,e){switch(A.debug("AtvlPlayerAdaptor AtvlPlayerEvent.playerStateChanged",t,e),t){case atv.player.states.FastForwarding:a.emit(rn.seeking,e);break;case atv.player.states.Loading:a.emit(rn.stalled,e);break;case atv.player.states.Paused:a.emit(rn.pause,e);break;case atv.player.states.Playing:a.emit(rn.playing,e);break;case atv.player.states.Rewinding:a.emit(rn.seeking,e)}})),i.on(Cn.onTimedMetadataChanged,(function(t){var e=t.key,n=t.extraAttributes.info,i=t.dataValue,r=i&&E.stringify(C.parse(i))||"";r.replace("\0",""),a.emit(rn.timedMetadata,new hn(e,n,r))})),i.on(Cn.didStopPlaying,(function(){a.emit(rn.stop),a.cleanup()})),i.on(Cn.playerTimeDidChange,(function(t){a.emit(rn.currentTime,t)})),a}return u(n,t),i(n,[{key:"stop",value:function(t){var e=t.message;atv.player.stopWithReason("Video Playback Has Stopped",e)}},{key:"cleanup",value:function(){this.bus.off(Cn.willStartPlaying),this.bus.off(Cn.onTimedMetadataChanged),this.bus.off(Cn.didStopPlaying)}},{key:"playbackConfig",set:function(t){if(t){var e=t.certificateUrl;A.debug("AtvlPlayerAdaptor setPlaybackConfig",e,t.protectionSystem),t.protectionSystem===Ve.StreamProtection.fairPlay&&e&&(this.secureKeyDelivery.certificateUrl=e)}}}]),n}(Tn),Dn=function(t){function n(t,i){var r;return e(this,n),(r=d(this,c(n).call(this,t))).bus=t.getEventBus(),r.constants=i,r.bus.subscribe(r.constants.Events.Player.ID3,h(r),(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.sample?t.sample.data:t,n=e instanceof Uint8Array?String.fromCharCode.apply(String,m(e)):e,i=["PRIV","TXXX"].find((function(t){return n.includes(t)}))||null,a=Object.keys(sn).map((function(t){return sn[t]})),o=a.find((function(t){return n.includes(t)}))||null,s=o?n.substring(n.lastIndexOf(o)+o.length).trim().replace(/\0/g,""):null,u=new hn(i,o,s);r.emit(rn.timedMetadata,u)})),r.alreadyStarted=!1,r.bus.subscribe(r.constants.Events.Player.PLAYING,h(r),(function(){A.trace("BAMTizenPlayerAdaptor Events.Player.PLAYING"),r.alreadyStarted?r.emit(rn.playing):(r.emit(rn.start),r.emit(rn.playing),r.alreadyStarted=!0)})),r.bus.subscribe(r.constants.Events.Player.TIME_UPDATE,h(r),(function(t){var e=t/1e3;r.emit(rn.currentTime,e)})),r.bus.subscribe(r.constants.Events.Player.PAUSE,h(r),(function(){A.trace("BAMTizenPlayerAdaptor Events.Player.PAUSE"),r.emit(rn.pause)})),r.bus.subscribe(r.constants.Events.Player.SEEKING,h(r),(function(){A.trace("BAMTizenPlayerAdaptor Events.Player.SEEKING"),r.emit(rn.seeking)})),r.bus.subscribe(r.constants.Events.Player.BUFFERING_START,h(r),(function(){A.trace("BAMTizenPlayerAdaptor Events.Player.BUFFERING_START"),r.emit(rn.stalled)})),r.bus.subscribe(r.constants.Events.Player.BUFFERING_END,h(r),(function(){A.trace("BAMTizenPlayerAdaptor Events.Player.BUFFERING_END"),r.emit(rn.playing)})),r.bus.subscribe(r.constants.Events.Player.COMPLETE,h(r),(function(){A.trace("BAMTizenPlayerAdaptor Events.Player.COMPLETE"),r.emit(rn.stop),r.cleanup()})),r}return u(n,t),i(n,[{key:"stop",value:function(t){this.nativePlayer.stop(),this.cleanup()}},{key:"cleanup",value:function(){this.alreadyStarted=!1,this.bus.unsubscribe(this.constants.Events.Player.ID3,this),this.bus.unsubscribe(this.constants.Events.Player.PLAYING,this),this.bus.unsubscribe(this.constants.Events.Player.TIME_UPDATE,this),this.bus.unsubscribe(this.constants.Events.Player.PAUSE,this),this.bus.unsubscribe(this.constants.Events.Player.SEEKING,this),this.bus.unsubscribe(this.constants.Events.Player.BUFFERING_START,this),this.bus.unsubscribe(this.constants.Events.Player.COMPLETE,this)}}]),n}(Tn),Un={opened:"opened",playing:"playing",ended:"ended",timedMetadata:"timedMetadata",error:"error",timeUpdate:"timeUpdate",stalled:"stalled",paused:"paused",seeking:"seeking"},Nn=function(t){function n(t,i){var r;if(e(this,n),r=d(this,c(n).call(this,t)),!t)throw new Error("nativePlayer must be supplied");r.nativePlayer=t;var a=function(t){t&&(A.debug("TrilithiumPlayerAdaptor.onOpened"),r.emit(rn.start))},o=function(){var e=t.currentTime;A.debug("TrilithiumPlayerAdaptor.onPlaying",e),r.emit(rn.playing,e)},s=function(t,e,n){var i=e,a=n.toString(),o=E.stringify(C.parse(n.toString("base64"))),s=a?o.substring(o.lastIndexOf(a)+a.length).trim().replace(/\0/g,""):o;A.debug("TrilithiumPlayerAdaptor.onTimedMetadata ".concat(i," ").concat(a," ").concat(s));var u=new hn(i,a,s);r.emit(rn.timedMetadata,u)},u=function(){r.emit(rn.stop),r.cleanup()},l=function(t){A.debug("TrilithiumPlayerAdaptor.onError",t),r.emit(rn.stop),r.cleanup()},h=function(){var e=t.currentTime;A.debug("TrilithiumPlayerAdaptor.onTimeUpdate",e),r.emit(rn.currentTime,e)},f=function(){var e=t.currentTime;A.debug("TrilithiumPlayerAdaptor.onStalled",e),r.emit(rn.stalled,e)};return i?(r.bus=i,i.on(Un.opened,a),i.on(Un.playing,o),i.on(Un.paused,(function(){var e=t.currentTime;A.debug("TrilithiumPlayerAdaptor.onPaused",e),r.emit(rn.pause,e)})),i.on(Un.timedMetadata,s),i.on(Un.ended,u),i.on(Un.error,l),i.on(Un.timeUpdate,h),i.on(Un.stalled,f),i.on(Un.seeking,(function(){var e=t.currentTime;A.debug("TrilithiumPlayerAdaptor.onSeeking",e),r.emit(rn.seeking,e)}))):(t.onOpened=a,t.onPlaying=o,t.onTimedMetadata=s,t.onEnded=u,t.onError=l,t.onTimeUpdate=h,t.onStalled=f),r}return u(n,t),i(n,[{key:"stop",value:function(t){}},{key:"cleanup",value:function(){this.bus&&(this.bus.off(Un.opened),this.bus.off(Un.playing),this.bus.off(Un.timedMetadata),this.bus.off(Un.ended),this.bus.off(Un.error),this.bus.off(Un.timeUpdate),this.bus.off(Un.stalled))}}]),n}(Tn),Ln=function(t){function n(t){var i;return e(this,n),(i=d(this,c(n).call(this,t))).nativePlayer=t,i.currentTime=i.nativePlayer.currentTime,i.onPlay=i.onPlay.bind(h(i)),i.nativePlayer.addEventListener("play",i.onPlay),i.onPause=i.onPause.bind(h(i)),i.nativePlayer.addEventListener("pause",i.onPause),i.onSeek=i.onSeek.bind(h(i)),i.nativePlayer.addEventListener("seeking",i.onSeek),i.onStop=i.onStop.bind(h(i)),i.nativePlayer.addEventListener("ended",i.onStop),i.onError=i.onError.bind(h(i)),i.nativePlayer.addEventListener("error",i.onError),i.onCurrentTime=i.onCurrentTime.bind(h(i)),i.nativePlayer.addEventListener("timeUpdate",i.onCurrentTime),i.onStall=i.onStall.bind(h(i)),i.nativePlayer.addEventListener("stalled",i.onStall),i}return u(n,t),i(n,[{key:"onPlay",value:function(t){this.emit(rn.start,t.timeStamp)}},{key:"onPause",value:function(){this.emit(rn.pause)}},{key:"onSeek",value:function(){this.emit(rn.seeking)}},{key:"onStop",value:function(){this.emit(rn.stop),this.cleanup()}},{key:"onError",value:function(){this.emit(rn.stop),this.cleanup()}},{key:"onCurrentTime",value:function(t){this.emit(rn.currentTime,t.timeStamp)}},{key:"onStall",value:function(t){this.emit(rn.stalled,t.timeStamp)}},{key:"stop",value:function(){this.nativePlayer.pause(),this.nativePlayer.setAttribute("src",""),this.nativePlayer.removeAttribute("src"),this.nativePlayer.currentTime=0}},{key:"cleanup",value:function(){this.nativePlayer.removeEventListener("start",this.onPlay),this.nativePlayer.removeEventListener("pause",this.onPause),this.nativePlayer.removeEventListener("error",this.onError),this.nativePlayer.removeEventListener("seeking",this.onSeek),this.nativePlayer.removeEventListener("stalled",this.onStall),this.nativePlayer.removeEventListener("timeupdate",this.onCurrentTime),this.nativePlayer.removeEventListener("ended",this.onStop)}}]),n}(Tn),Rn=function(t){function n(t){var i;e(this,n);var r=t;return(i=d(this,c(n).call(this,t)))._loadCompleteHandler=i._loadCompleteHandler.bind(h(i)),r.addEventListener(cast.framework.events.EventType.PLAYER_LOAD_COMPLETE,i._loadCompleteHandler),i._id3Handler=i._id3Handler.bind(h(i)),r.addEventListener(cast.framework.events.EventType.ID3,i._id3Handler),i._mediaFinishedHandler=i._mediaFinishedHandler.bind(h(i)),r.addEventListener(cast.framework.events.EventType.MEDIA_FINISHED,i._mediaFinishedHandler),i._timeUpdateHandler=i._timeUpdateHandler.bind(h(i)),r.addEventListener(cast.framework.events.EventType.TIME_UPDATE,i._timeUpdateHandler),i._playingHandler=i._playingHandler.bind(h(i)),r.addEventListener(cast.framework.events.EventType.PLAYING,i._playingHandler),i._pauseHandler=i._pauseHandler.bind(h(i)),r.addEventListener(cast.framework.events.EventType.PAUSE,i._pauseHandler),i}return u(n,t),i(n,[{key:"_loadCompleteHandler",value:function(t){A.debug("ChromecastPlayerAdaptor: PLAYER_LOAD_COMPLETE",t),this.emit(rn.start)}},{key:"_id3Handler",value:function(t){if(A.debug("ChromecastPlayerAdaptor._id3Handler",t),t.segmentData){var e=String.fromCharCode.apply(String,m(t.segmentData));A.trace("ChromecastPlayerAdaptor._id3Handler",e);var n=["PRIV","TXXX"].find((function(t){return e.includes(t)}))||null,i=Object.keys(sn).map((function(t){return sn[t]})).find((function(t){return e.includes(t)}))||null,r=i?e.substring(e.lastIndexOf(i)+i.length).trim().replace(/\0/g,""):null,a=new hn(n,i,r);A.trace("ChromecastPlayerAdaptor._id3Handler","tag:",n,"owner:",i,"dataValue:",r),this.emit(rn.timedMetadata,a)}}},{key:"_timeUpdateHandler",value:function(t){var e=t.currentMediaTime;this.emit(rn.currentTime,e)}},{key:"_playingHandler",value:function(t){var e=t.currentMediaTime;this.emit(rn.playing,e)}},{key:"_pauseHandler",value:function(t){var e=t.currentMediaTime;this.emit(rn.pause,e)}},{key:"_mediaFinishedHandler",value:function(t){A.debug("ChromecastPlayerAdaptor: MEDIA_FINISHED",t),this.emit(rn.stop),this.cleanup()}},{key:"stop",value:function(t){this.nativePlayer.stop()}},{key:"cleanup",value:function(){var t=this.nativePlayer;t&&(t.removeEventListener(cast.framework.events.EventType.PLAYER_LOAD_COMPLETE,this._loadCompleteHandler),t.removeEventListener(cast.framework.events.EventType.ID3,this._id3Handler),t.removeEventListener(cast.framework.events.EventType.MEDIA_FINISHED,this._mediaFinishedHandler),t.removeEventListener(cast.framework.events.EventType.TIME_UPDATE,this._timeUpdateHandler),t.removeEventListener(cast.framework.events.EventType.PAUSE,this._pauseHandler),this.nativePlayer=null)}}]),n}(Tn),jn=function(t){function n(t){var i;return e(this,n),(i=d(this,c(n).call(this,t))).authenticatedProviderId=null,i.providerDataSource=null,i}return u(n,t),i(n,[{key:"setToken",value:function(t,e,n){this.token=t,this.tokenType=e,this.resource=n}},{key:"checkAuthentication",value:function(){var t=this,e=this.authenticatedProviderId;if(!e||this.authenticatedProvider&&e===this.authenticatedProvider.id)return w.resolve(this.isAuthenticated);if(!this.providerDataSource)return this.authenticatedProvider=new jt(e,e,null),w.resolve(this.isAuthenticated);var n,i="ADOBEPASS"===(n=this.tokenType)?_e:"DEVICE"===n?Te:null;return this.providerDataSource.getProvider(e,i).then((function(n){var i=n.getPreferredLogoUrl(t.partner,t.platform);return t.authenticatedProvider=new Ht(e,n.name,i,n.websiteUrl,n.streamLimiting),w.resolve(t.isAuthenticated)})).catch((function(){return t.authenticatedProvider=new Ht(e,e,null,null,null),w.resolve(t.isAuthenticated)}))}},{key:"authenticate",value:function(t,e,n,i){return this.authenticatedProviderId=t,this.authenticatedIdentity=e,this.setToken(n,i),this.checkAuthentication()}},{key:"deauthenticate",value:function(){return this.authenticatedProvider=null,this.authenticatedIdentity=null,this.token=null,this.tokenType=null,this.resource=null,w.resolve(!0)}},{key:"checkAuthorization",value:function(t){var e,n="ADOBEPASS"===(e=this.tokenType)?dt.mvpd:"DEVICE"===e?dt.isp:"BAM"===e?dt.direct:null;if(!this.isAuthenticated||-1===t.authTypes.indexOf(n)&&"DEVICE"!==this.tokenType&&"GATEKEEPER"!==this.tokenType)return w.resolve(new xt(!1));var i={token:this.token,tokenType:this.tokenType};this.resource&&(i.resource=this.resource);var r=new Bt(n,this.authenticatedProvider,this.authenticatedIdentity,i),a=new xt(!0,r);return w.resolve(a)}},{key:"preauthorizedResources",get:function(){return[]}},{key:"isAuthenticated",get:function(){return!!this.token&&!!this.tokenType},set:function(t){}},{key:"authenticatedIdentity",get:function(){return localStorage.getItem("TokenAuthenticator.authenticatedIdentity")},set:function(t){t?localStorage.setItem("TokenAuthenticator.authenticatedIdentity",t):localStorage.removeItem("TokenAuthenticator.authenticatedIdentity")}},{key:"authenticatedProvider",get:function(){var t=localStorage.getItem("TokenAuthenticator.authenticatedProvider");try{return jt.fromJson(JSON.parse(t))}catch(t){return null}},set:function(t){t?localStorage.setItem("TokenAuthenticator.authenticatedProvider",JSON.stringify(t)):localStorage.removeItem("TokenAuthenticator.authenticatedProvider")}}]),n}(Rt),Hn=function(t){function n(t,i,r,a,o,s,u,l){var h;return e(this,n),(h=d(this,c(n).call(this,t,i,r,a,o,s))).convivaData=u,h.segmentTypes=l,h}return u(n,t),i(n,[{key:"convivaContentMetadata",get:function(){var t=this.mediaItem.tracking[lt.conviva];return t.custom=a(t.custom,this.convivaData),t}}]),n}(Be),zn=function(t){function n(t,i,r,a){var o;e(this,n),o=d(this,c(n).call(this,t,i));try{var s="undefined"!=typeof window?window:h(o);o.BAMSDK=a||s&&s["bam-browser-sdk"]}catch(t){return d(o)}var u=o.BAMSDK,l=u.Services,f=u.SdkSession;o.bootstrapConfig=new l.Configuration.BootstrapConfiguration({clientId:r.clientId,clientApiKey:r.clientApiKey,environment:r.environment,debugEnabled:r.debugEnabled}),o.identityProviderId=r.partnerId,o.sdkSession=null;return f.createSdkSession(o.bootstrapConfig,null).then((function(t){return A.debug("BAMAuthenticator.constructor createSdkSession() complete",t),o.sdkSession=t,t.initialize()})).then((function(t){o._deferredCompletions.forEach((function(t){t()})),o._deferredCompletions=[],A.debug("BAMAuthenticator.constructor sdkSession.initialize() complete")})),o._isAuthenticated=!1,o._identityToken=null,o._deferredCompletions=[],o.playerAdapterFactory={buildPlayerAdapter:function(){return null}},o}return u(n,t),i(n,[{key:"checkAuthentication",value:function(){var t=this,e=this.identityProviderId;return this.sdkSession?this.sdkSession.isInitialized?this.sdkSession.isAuthorized(e).then((function(e){return t.isAuthenticated=e,e})):(A.debug("BAMAuthenticator.checkAuthentication deferring checkAuthentication() response"),new w((function(n){t._deferredCompletions.push((function(){n(t.isAuthenticated)})),t.sdkSession.isAuthorized(e).then((function(e){return t.isAuthenticated=e,e}))}))):w.resolve(!1)}},{key:"authenticate",value:function(t){var e=this;if(A.debug("BAMAuthenticator.authenticate",t),!this.sdkSession)return w.resolve(!1);var n=this.identityProviderId;return this.sdkSession.accountApi.authorize(t,n).then((function(){return e.isAuthenticated=!0,e._identityToken=t,e.isAuthenticated}))}},{key:"deauthenticate",value:function(){if(!this.sdkSession)return w.resolve(!1);this.sdkSession.reset(),this.isAuthenticated=!1,this._identityToken=null}},{key:"checkAuthorization",value:function(t,e){var n=this;if(!this.sdkSession)throw new Error("sdkSession has not been initialized.");var i=this.BAMSDK.Media.MediaDescriptor,r=this.sdkSession.mediaApi,a=this.playerAdapterFactory.buildPlayerAdapter();if(!a)throw new Error("playerAdapterFactory did not produce a playerAdapter.");var o,u=new i({mediaLocation:t.source.url,adTargeting:s({trk:"s",platform:this.platform,partnr:"espn"},e&&e.dictionaryForAdEngine()||[])});return r.createPlaybackSession(a).then((function(t){return o=t,r.fetch(u)})).then((function(t){var e={playbackSession:o,mediaItem:t};n._identityToken&&(e.identityToken=n._identityToken);var i=n.sdkSession.getAccessState();i&&(e.token=i,e.tokenType="BAM_ACCESS_STATE");var r=new Bt(dt.direct,n.authenticatedProvider,n.authenticatedIdentity,e);return new xt(!0,r)}))}},{key:"initPlaybackSession",value:function(t,e,n){var i=arguments.length>4?arguments[4]:void 0;if(!this.sdkSession)throw new Error("sdkSession has not been initialized.");var r=this.BAMSDK.Media.MediaAnalyticsKey,a=i.userInfo,o=a.playbackSession,s=a.mediaItem;return w.all([s.getSegmentTypes(),s.getTrackingData(r.CONVIVA),o.prepare(s)]).then((function(e){var n=g(e,3),r=n[0],a=n[1],o=n[2];return new Hn(o.streamUri,t,t.seekInSeconds,i.authenticationType,i.authenticatedProvider,i.authenticatedIdentity,a||[],r)}))}},{key:"isAuthenticated",get:function(){return this._isAuthenticated},set:function(t){this._isAuthenticated=t}},{key:"authenticatedIdentity",get:function(){return null},set:function(t){}},{key:"authenticatedProvider",get:function(){return null},set:function(t){}},{key:"preauthorizedResources",get:function(){return[]}}]),n}(Rt);t.AdEnvironment=te,t.AdProvider=$t,t.AdvertisingInfo=ie,t.AtvlPlayerAdaptor=On,t.AtvlPlayerEvent=Cn,t.AtvlPlayerEventBus=En,t.AuthenticationManager=nn,t.AuthenticationType=dt,t.AuthorizationType=tt,t.BAMAuthenticator=zn,t.BAMTizenPlayerAdaptor=Dn,t.ChromecastPlayerAdaptor=Rn,t.Client=$,t.DomesticLocationProvider=Ct,t.DrmSupport=Xe,t.FanManager=me,t.HTML5PlayerAdaptor=Ln,t.LocationProvider=Et,t.MediaItemAPI=Lt,t.NielsenCloudAPIClient=vn,t.NielsenTrackingManager=yn,t.PlaybackConfig=Ve,t.PlaybackManager=Pn,t.PlayerAdaptor=Tn,t.PlayerEventBus=En,t.TokenAuthenticator=jn,t.TrilithiumPlayerAdaptor=Nn,t.TrilithiumPlayerEvent=Un,t.log=I,t.uuid=P,Object.defineProperty(t,"__esModule",{value:!0})}));


}
/*
     FILE ARCHIVED ON 04:43:30 Oct 21, 2020 AND RETRIEVED FROM THE
     INTERNET ARCHIVE ON 01:29:52 Jul 18, 2023.
     JAVASCRIPT APPENDED BY WAYBACK MACHINE, COPYRIGHT INTERNET ARCHIVE.

     ALL OTHER CONTENT MAY ALSO BE PROTECTED BY COPYRIGHT (17 U.S.C.
     SECTION 108(a)(3)).
*/
/*
playback timings (ms):
  captures_list: 107.883
  exclusion.robots: 0.102
  exclusion.robots.policy: 0.089
  cdx.remote: 0.075
  esindex: 0.011
  LoadShardBlock: 42.632 (3)
  PetaboxLoader3.datanode: 46.505 (5)
  load_resource: 117.747 (2)
  PetaboxLoader3.resolve: 82.038 (2)
*/